"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5749],{5845:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var l=r(3736),t=r(4848),s=r(8453);const o={layout:"single",title:"Setup Prometheus on private k8s cluster",date:"2024-12-17 16:16:01 -0600",categories:"work",tags:["Observability","Prometheus","Loki","Tempo","Opentelemetry","auto-instrument"],author_profile:!1,toc:!0,toc_label:"On This Page",toc_icon:"cog",toc_position:"sticky",authors:["hansgun"]},i="Prolog",a={authorsImageUrls:[void 0]},c=[{value:"0. \uad6c\uc131\uc694\uc18c - \uc124\uce58\ud55c \ub0b4\uc6a9",id:"0-\uad6c\uc131\uc694\uc18c---\uc124\uce58\ud55c-\ub0b4\uc6a9",level:2},{value:"0-1. Trace \uc124\uc815 \uad00\ub828",id:"0-1-trace-\uc124\uc815-\uad00\ub828",level:3},{value:"1. \ud658\uacbd \uc124\uc815",id:"1-\ud658\uacbd-\uc124\uc815",level:2},{value:"1-1. \ub2e4\uc6b4\ub85c\ub4dc \ud658\uacbd",id:"1-1-\ub2e4\uc6b4\ub85c\ub4dc-\ud658\uacbd",level:3},{value:"1-1-1. docker image download",id:"1-1-1-docker-image-download",level:4},{value:"2. install kube-prometheus-stack",id:"2-install-kube-prometheus-stack",level:2},{value:"2-1. helm chart download",id:"2-1-helm-chart-download",level:3},{value:"2-2. edit values.yaml",id:"2-2-edit-valuesyaml",level:3},{value:"2-3. install prometheus",id:"2-3-install-prometheus",level:3},{value:"3. Log \uc124\uc815",id:"3-log-\uc124\uc815",level:2},{value:"3-1. Loki \uc124\uc815",id:"3-1-loki-\uc124\uc815",level:3},{value:"3-1-1. \uc6cc\ud0b9 \ub514\ub809\ud130\ub9ac \ubcc0\uacbd",id:"3-1-1-\uc6cc\ud0b9-\ub514\ub809\ud130\ub9ac-\ubcc0\uacbd",level:4},{value:"3-1-2. <code>values.yaml</code> \ud30c\uc77c \ud3b8\uc9d1",id:"3-1-2-valuesyaml-\ud30c\uc77c-\ud3b8\uc9d1",level:4},{value:"3-1-3. loki-distributed install",id:"3-1-3-loki-distributed-install",level:4},{value:"3-1-4. Loki \uc124\uce58 \ud655\uc778",id:"3-1-4-loki-\uc124\uce58-\ud655\uc778",level:4},{value:"3-2. promtail \uc124\uc815",id:"3-2-promtail-\uc124\uc815",level:3},{value:"3-2-1. \uc6cc\ud0b9 \ub514\ub809\ud130\ub9ac \ubcc0\uacbd",id:"3-2-1-\uc6cc\ud0b9-\ub514\ub809\ud130\ub9ac-\ubcc0\uacbd",level:4},{value:"3-2-2. <code>values.yaml</code> \ud30c\uc77c \ud3b8\uc9d1",id:"3-2-2-valuesyaml-\ud30c\uc77c-\ud3b8\uc9d1",level:4},{value:"3-2-3. <code>install promtail</code>",id:"3-2-3-install-promtail",level:4},{value:"3-3. promtail \uc124\uce58 \ud655\uc778",id:"3-3-promtail-\uc124\uce58-\ud655\uc778",level:3},{value:"4. <code>Trace</code> \uc124\uc815",id:"4-trace-\uc124\uc815",level:2},{value:"4-0. opentelemetry \uac1c\uc694",id:"4-0-opentelemetry-\uac1c\uc694",level:3},{value:"4-1. \uc124\uce58 \uc21c\uc11c",id:"4-1-\uc124\uce58-\uc21c\uc11c",level:3},{value:"4-2. <code>cert manager</code> \uc124\uce58",id:"4-2-cert-manager-\uc124\uce58",level:3},{value:"4-3. <code>opentelemetry operator</code> \uc124\uce58",id:"4-3-opentelemetry-operator-\uc124\uce58",level:3},{value:"4-3-1. <code>values.yaml</code> \ud3b8\uc9d1\ub0b4\uc6a9",id:"4-3-1-valuesyaml-\ud3b8\uc9d1\ub0b4\uc6a9",level:4},{value:"4-3-2. <code>opentelemetry-collector</code> \uc124\uce58",id:"4-3-2-opentelemetry-collector-\uc124\uce58",level:4},{value:"4-4. <code>opentelemetry-instatruments</code> \uc124\uc815",id:"4-4-opentelemetry-instatruments-\uc124\uc815",level:3},{value:"4-4-1. [\ucc38\uace0] otel-instrumentation",id:"4-4-1-\ucc38\uace0-otel-instrumentation",level:4},{value:"5. <code>Tempo</code> \uc124\uce58",id:"5-tempo-\uc124\uce58",level:2},{value:"5-1. <code>values.yaml</code> \ud3b8\uc9d0",id:"5-1-valuesyaml-\ud3b8\uc9d0",level:3},{value:"5-2. <code>Tempo</code> install",id:"5-2-tempo-install",level:3},{value:"6. Exporter \uc124\uce58",id:"6-exporter-\uc124\uce58",level:2},{value:"6-1. <code>postgresql-exporter</code> \uc124\uce58",id:"6-1-postgresql-exporter-\uc124\uce58",level:3},{value:"6-1-1. \uc124\uc815 \uac12 \ubcc0\uacbd",id:"6-1-1-\uc124\uc815-\uac12-\ubcc0\uacbd",level:4},{value:"6-1-2. <code>postgresql-exporter</code> \uc124\uce58",id:"6-1-2-postgresql-exporter-\uc124\uce58",level:4},{value:"6-1-3. <code>prometheus exporter</code> \uc124\uc815",id:"6-1-3-prometheus-exporter-\uc124\uc815",level:4},{value:"6-2. <code>redis-exporter</code> \uc124\uce58",id:"6-2-redis-exporter-\uc124\uce58",level:3},{value:"6-2-1. <code>values.yaml</code> \ud3b8\uc9d1",id:"6-2-1-valuesyaml-\ud3b8\uc9d1",level:4},{value:"7. [\ucc38\uace0 \uc0ac\uc774\ud2b8]",id:"7-\ucc38\uace0-\uc0ac\uc774\ud2b8",level:2},{value:"8. Epilog",id:"8-epilog",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",del:"del",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"summary"}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\uc0c1\uc6a9 SaaS Observability \ud234\uc740 modern\ud55c \uadf8\ub798\ud53d\uacfc \ud3b8\uc758\uc131\uc744 \uc81c\uacf5\ud558\uc9c0\ub9cc(ex",":Datadog","), \uc0ac\uc6a9\ub7c9 base\ub85c \uacfc\uae08\uc73c\ub85c \ucd5c\uc801\ud654 \ud558\uc9c0 \uc54a\uc740 Log, Trace \ud639\uc740 Profile \uae30\ub2a5\uc744 \ud65c\uc6a9 \uc2dc \uacfc\uae08 \ud3ed\ud0c4\uc744 \ub9de\uace0 \uc788\ub2e4."]}),"\n",(0,t.jsx)(n.li,{children:"Open Source \uc774\uc790, k8s \ud658\uacbd\uc5d0 \uc798 \uc801\uc6a9\ub418\uace0, \ube60\ub974\uac8c \ubc1c\uc804\uc911\uc778 Prometheus\ub85c \ub300\uccb4 \ud558\uace0\uc790 \ud604 \uc6b4\uc601\uc911\uc778 private k8s cluster\uc5d0 prometheus stack\uc744 \uc801\uc6a9\ud55c \uc774\uc57c\uae30\ub97c \uc801\uc5b4\ubcf8\ub2e4."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trace"})," \uae30\ub2a5 \uad6c\ud604\uc744 search \ud558\ub358 \uc911 ",(0,t.jsx)(n.code,{children:"open-telemetry"})," \ub97c \ubc1c\uacac\ud558\uc600\uc73c\uba70, \ub2e4\uc2dc \uad6c\ucd95\ud55c\ub2e4\uba74 ",(0,t.jsx)(n.code,{children:"opentelemetry stack"})," \uc744 \ud65c\uc6a9\ud558\uc5ec scratch \ubd80\ud130 \uad6c\uc131\ud558\uaca0\uc9c0\ub9cc, ",(0,t.jsx)(n.code,{children:"kube-prometheus-stack"})," \uc758 \ud3b8\ub9ac\ud568\uc744 \ud55c \ubc88 \ub9db\ubcf4\uace0 ",(0,t.jsx)(n.del,{children:"\ub098\ub2c8 \ub3cc\uc544\uac00\uace0 \uc2f6\uc9c0 \uc54a\ub2e4."})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"0-\uad6c\uc131\uc694\uc18c---\uc124\uce58\ud55c-\ub0b4\uc6a9",children:"0. \uad6c\uc131\uc694\uc18c - \uc124\uce58\ud55c \ub0b4\uc6a9"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Prometheus - [ kube-prometheus-stack ]"}),"\n",(0,t.jsx)(n.li,{children:"Loki - for log"}),"\n",(0,t.jsx)(n.li,{children:"Tempo, Opentelemetry Agent - for trace"}),"\n",(0,t.jsx)(n.li,{children:"Exporters - Redis, PostgreSQL"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"0-1-trace-\uc124\uc815-\uad00\ub828",children:"0-1. Trace \uc124\uc815 \uad00\ub828"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\uace0\ub824\ud55c \uc194\ub8e8\uc158\uc740 ",(0,t.jsx)(n.code,{children:"Jaeger"}),", ",(0,t.jsx)(n.code,{children:"Zipkin"}),", ",(0,t.jsx)(n.code,{children:"Tempo"})," \ub4f1\uc774 \uc788\uc73c\uba70, \uc55e\uc758 2\uac1c \uc194\ub8e8\uc158\uc740 \uba87 \uac00\uc9c0 \ub2e8\uc810\uc774 \uc788\uc73c\uba70 \uc0ac\uc2e4 \uc0c1 deprecated \ub418\uc5b4 Tempo\ub97c \ud65c\uc6a9\ud558\uae30\ub85c \uacb0\uc815","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Jeager"})," : CNCF \ub4f1\ub85d \ud504\ub85c\uc81d\ud2b8\uc774\ub098, \uc124\uc815\uc774 \ubcf5\uc7a1\ud568"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Zipkin"})," : Java \uc9c4\uc601\uc758 Trace\uc6a9 \uc194\ub8e8\uc158\uc73c\ub85c, \ucee4\ubba4\ub2c8\ud2f0 \ud65c\uc131\ud654\uac00 \ub418\uc5b4 \uc788\uc9c0 \uc54a\uc544 \uc774\uc288 \ud574\uacb0\uc758 \uc5b4\ub824\uc6c0."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Tempo"})," : \uc0c1\ub300\uc801\uc73c\ub85c \uc2e0\uc0dd \ud504\ub85c\uc81d\ud2b8\uc774\ub098 ",(0,t.jsx)(n.code,{children:"Grafana"})," \uc9c4\uc601\uc5d0\uc11c \uc8fc \ud504\ub85c\uc81d\ud2b8\ub85c \uad00\ub9ac\ud558\uace0, ",(0,t.jsx)(n.code,{children:"Grafana"})," \uc0dd\ud0dc\uacc4\uc640 \uc5f0\ub3d9\ud558\uae30 \uc88b\uc74c. ",(0,t.jsx)(n.del,{children:"UI! \uc9f1"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Opentelemetry Auto-instruments"}),"\ub97c \uc774\uc6a9\ud574 Trace data\ub97c \uc8fc\uc785\ud558\uace0\uc790 \ud558\uc600\uc73c\ub098, ",(0,t.jsx)(n.code,{children:"8443 port"}),"\ub97c k8s cluster node \ub2e8\uc5d0\uc11c \uc624\ud508\uc774 \ud544\uc694\ud558\uc5ec \uc774 \ubd80\ubd84\uc740 \uc0dd\ub7b5\ud568. ",(0,t.jsx)(n.del,{children:"\uc0ac\uc2e4 namespace\ubcc4, service\ubcc4 operator \ubc30\ud3ec\uac00 \uadc0\ucc2e\uc740 \uac83\ub3c4.."})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"1-\ud658\uacbd-\uc124\uc815",children:"1. \ud658\uacbd \uc124\uc815"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\ud544\uc694 \ud504\ub85c\uadf8\ub7a8"}),"\n",(0,t.jsx)(n.li,{children:"k8s agent - connecto to cluster"}),"\n",(0,t.jsx)(n.li,{children:"helm"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"1-1-\ub2e4\uc6b4\ub85c\ub4dc-\ud658\uacbd",children:"1-1. \ub2e4\uc6b4\ub85c\ub4dc \ud658\uacbd"}),"\n",(0,t.jsx)(n.h4,{id:"1-1-1-docker-image-download",children:"1-1-1. docker image download"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"private cluster \uc5d0\uc11c public docker image download\uac00 \ubd88\uac00\ub2a5 \ud558\ubbc0\ub85c, CI/CD Agent \uc11c\ubc84\uc5d0\uc11c \uc774\ubbf8\uc9c0 \ub2e4\uc6b4\ub85c\ub4dc \ud6c4 proxy \uc11c\ubc84(Azure Artifacts)\uc5d0 \ub4f1\ub85d\ud558\uc5ec k8s cluster\uc5d0 \uc124\uce58 \ud568"}),"\n",(0,t.jsx)(n.li,{children:"\uc608\uc81c"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"## sharedprdacr.azureacr.io \uc5d0 docker login \ub418\uc5b4 \uc788\uc5b4\uc57c \ud568.. azure service account \ub85c \uac00\ub2a5 \n## 1. download\ndocker pull docker.io/grafana/grafana:11.2.0 \ndocker pull registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6\n\n## 2. taggging\ndocker tag docker.io/grafana/grafana:11.2.0 sharedprdacr.azureacr.io/grafana/grafana:11.2.0\ndocker tag registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6 sharedprdacr.azureacr.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6\n\n## 3. push \ndocker push sharedprdacr.azureacr.io/grafana/grafana:11.2.0 \ndocker push sharedprdacr.azureacr.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6\n"})}),"\n",(0,t.jsx)(n.h2,{id:"2-install-kube-prometheus-stack",children:"2. install kube-prometheus-stack"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"2-1-helm-chart-download",children:"2-1. helm chart download"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"kube-prometheus-stack \uc124\uce58"}),"\n",(0,t.jsxs)(n.li,{children:["namespace \uba85 : ",(0,t.jsx)(n.code,{children:"ns-prometheus"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"WORKDIR = /data/mgmt/prometheus\n\n### repo add\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n\n### helm pull\ncd ${WORKDIR}\nhelm pull prometheus-community/kube-prometheus-stack \n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-2-edit-valuesyaml",children:"2-2. edit values.yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'cd kube-prometheus-stack/\n\n## values.yaml \ubc31\uc5c5\ncp values.yaml values_241217.yaml \n\n### vi \ub85c values.yaml \ud30c\uc77c \ud3b8\uc9d1\n## docker registry \ubcc0\uacbd\nglobal.imageRegistry : "sharedacr.azureacr.io"\nglobal.imagePullSecrets : [XXXXXXXX]\n\n## alert manager off \nalertmanager.enabled : false\n\n## registry\n:s/(docker.io|registry.k8s.io|quay.io|gcr.io|ghcr.io)/shared.azureacr.io/g\n\n\n## grafana : k8s service \ub85c \ub4f1\ub85d \uc608\uc815\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-3-install-prometheus",children:"2-3. install prometheus"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl config use-context <<cluster context>>; helm upgrade --install prometheus . -n ns-prometheus --create-namespace -f values.yaml\n"})}),"\n",(0,t.jsx)(n.h2,{id:"3-log-\uc124\uc815",children:"3. Log \uc124\uc815"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"loki\ub97c \ud1b5\ud558\uc5ec log\ub97c \uc804\ub2ec \ubc1b\uc544 cloud\uc5d0 Object storage \uc5d0 \uc800\uc7a5\ud558\ub294 \ub85c\uc9c1\uc744 \uad6c\ud604."}),"\n",(0,t.jsx)(n.li,{children:"Loki\uc5d0\uc11c\ub294 cloud storage \uc124\uc815, promtail \uc740 loki\uc640 \uc5f0\uacb0\ud558\ub294 \uc778\ud130\ud398\uc774\uc2a4 \uc124\uc815\uc774 \ud544\uc694"}),"\n",(0,t.jsx)(n.li,{children:"\uc124\uc815\uc744 \uc704\ud55c helm chart\ub294 grafana\ub97c \uc774\uc6a9\ud558\ubbc0\ub85c \uac1c\ubcc4 \uc124\uc815 \ubcc0\uacbd \uc804\uc5d0 \uba3c\uc800 \ub2e4\uc6b4 \ubc1b\uc544 \ub454\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"## helm repo add\nhelm repo add grafana https://grafana.github.io/helm-charts\nhelm repo update\nhelm pull grafana-stack \n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-1-loki-\uc124\uc815",children:"3-1. Loki \uc124\uc815"}),"\n",(0,t.jsx)(n.h4,{id:"3-1-1-\uc6cc\ud0b9-\ub514\ub809\ud130\ub9ac-\ubcc0\uacbd",children:"3-1-1. \uc6cc\ud0b9 \ub514\ub809\ud130\ub9ac \ubcc0\uacbd"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ${WORKDIR}/grafana-stack/charts/loki-distributed\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"3-1-2-valuesyaml-\ud30c\uc77c-\ud3b8\uc9d1",children:["3-1-2. ",(0,t.jsx)(n.code,{children:"values.yaml"})," \ud30c\uc77c \ud3b8\uc9d1"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'...(\uc0dd\ub7b5)..\nschemaConfig:\n  configs:\n  - from: "2024-09-11"\n    index:\n      period: 24h\n      prefix: index_\n    object_store: azure\n    schema: v13\n    store: tsdb\nstorageConfig:\n  azure:\n    account_name: <\uc2a4\ud1a0\ub9ac\uc9c0\uc774\ub984> \n    account_key: BO1dfASaldkjfklUXAlkjasldkfjalskjf==\n    container_name: prometheus\n    use_managed_identity: false\n    request_timeout: 0 \n  tsdb_shipper:\n    active_index_directory: var/loki/index ### var \uc55e\uc5d0 / \ucd94\uac00\ud560 \uacbd\uc6b0 \uc5d0\ub7ec \ubc1c\uc0dd\n    cache_location: var/loki/index_cache\n    cache_ttl: 24h\n  filesystem: \n    directory: var/loki/chunks\n...(\ud558\ub7b5)...\n'})}),"\n",(0,t.jsx)(n.h4,{id:"3-1-3-loki-distributed-install",children:"3-1-3. loki-distributed install"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"## k8s context \uc120\ud0dd\nkubectl config use-context <cluster-context>\n\n## install \nhelm upgrade --install loki . -n ns-prometheus -f values.yaml\n"})}),"\n",(0,t.jsx)(n.h4,{id:"3-1-4-loki-\uc124\uce58-\ud655\uc778",children:"3-1-4. Loki \uc124\uce58 \ud655\uc778"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ k get po -n ns-prometheus | grep -i loki \nNAME                                                        READY   STATUS  RESTART AGE\nloki-loki-distritubed-gateway-6dc5578cb9-j7scf              1/1     Running 0       10d\nloki-loki-distritubed-distributor-6dc5578cb9-j7scf          1/1     Running 0       10d\nloki-loki-distritubed-ingester-0                            1/1     Running 0       10d\nloki-loki-distritubed-querier-0                             1/1     Running 0       10d\nloki-loki-distritubed-query-frontend-8689676f4f-h8wn4-0     1/1     Running 0       10d\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-2-promtail-\uc124\uc815",children:"3-2. promtail \uc124\uc815"}),"\n",(0,t.jsx)(n.h4,{id:"3-2-1-\uc6cc\ud0b9-\ub514\ub809\ud130\ub9ac-\ubcc0\uacbd",children:"3-2-1. \uc6cc\ud0b9 \ub514\ub809\ud130\ub9ac \ubcc0\uacbd"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd $WORKDIR/grafana-stack/charts/promtail\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"3-2-2-valuesyaml-\ud30c\uc77c-\ud3b8\uc9d1",children:["3-2-2. ",(0,t.jsx)(n.code,{children:"values.yaml"})," \ud30c\uc77c \ud3b8\uc9d1"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"....(\uc0dd\ub7b5)....\nclients:\n- url: http://loki-loki-distributed-gateway/loki/api/v1/push\n....(\ud558\ub7b5)....\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"3-2-3-install-promtail",children:["3-2-3. ",(0,t.jsx)(n.code,{children:"install promtail"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm upgradee --install promtail . -n ns-prometheus -f values.yaml\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"[to-do] multi-line \ucc98\ub9ac"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-3-promtail-\uc124\uce58-\ud655\uc778",children:"3-3. promtail \uc124\uce58 \ud655\uc778"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ k get po -n ns-prometheus | grep -i promtail\nNAME                    READY   STATUS  RESTART AGE\npromtail-2f8v9          1/1     Running 0       10d\npromtail-2f8v9          1/1     Running 0       10d\npromtail-2f8v9          1/1     Running 0       10d\npromtail-2f8v9          1/1     Running 0       10d\npromtail-2f8v9          1/1     Running 0       10d\npromtail-2f8v9          1/1     Running 0       10d\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"4-trace-\uc124\uc815",children:["4. ",(0,t.jsx)(n.code,{children:"Trace"})," \uc124\uc815"]}),"\n",(0,t.jsx)(n.h3,{id:"4-0-opentelemetry-\uac1c\uc694",children:"4-0. opentelemetry \uac1c\uc694"}),"\n",(0,t.jsx)(n.h3,{id:"4-1-\uc124\uce58-\uc21c\uc11c",children:"4-1. \uc124\uce58 \uc21c\uc11c"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\uba3c\uc800 opentelemetry \uc124\uce58 \uc804\uc5d0 cert manager\ub97c \uc124\uce58\ud544\uc694(requirement)"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"opentelemetry trace\ub294 CRD \ud615\ud0dc\ub85c \ubc30\ud3ec \ud6c4 operator resource\ub97c \uc124\uce58\ud558\uace0 collector \uc11c\ube44\uc2a4\ub97c \uae30\ub3d9\ud558\uc5ec \uc218\uc9d1\uc744 \uc704\ud55c \ud658\uacbd\uc744 \ub9cc\ub4e0\ub2e4."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\uc55e\uc11c \uc0dd\uc131\ud55c collector\uc5d0 \uc2e4\uc81c trace \ub370\uc774\ud130\ub97c \uc804\uc1a1\ud558\ub294 agent\ub294 \uba87 \uac00\uc9c0 \ubc29\ubc95\uc73c\ub85c \uc124\uce58\ud560 \uc218 \uc788\ub294\ub370, CI/CD pipeline\uc744 \ud1b5\ud574 \uc790\ub3d9\ud654\ud558\ub824\uba74 \ud06c\uac8c 2\uac00\uc9c0 \ubc29\ubc95\uc73c\ub85c \uc815\ub9ac\ub41c\ub2e4."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"autoinstrument k8s object\ub97c \uc0dd\uc131\ud558\uc5ec label selector\ub97c \ud1b5\ud558\uc5ec \uc790\ub3d9 \uc801\uc6a9"}),"\n",(0,t.jsx)(n.li,{children:"opentelemery agent\ub97c JVM \uad6c\ub3d9 \uc2dc library \ud615\ud0dc\ub85c \uc8fc\uc785\ud558\uace0, \uc124\uc815\uc5d0 \ud544\uc694\ud55c \ud658\uacbd\ubcc0\uc218\ub4e4\uc740 helm \ubc30\ud3ec \uc2dc \uc8fc\uc785\ub418\ub3c4\ub85d \uc870\uc791"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["\uc55e\uc120 \ubc29\ubc95 \uc911 1\ubc88\uc758 \uacbd\uc6b0 cert manager\uc640 \ud1b5\uc2e0\uc744 \uc704\ud574\uc11c k8s cluster nodeport \uc5d0 \ub300\ud574 open\uc774 \ud544\uc694\ud558\ub098(",(0,t.jsx)(n.code,{children:"port : 8443"}),") private cluster\uc758 \ubc29\ud654\ubcbd open \ud544\uc694. ",(0,t.jsx)(n.del,{children:"\uc815\ubcf4\ubcf4\uc548\ud300\uc5d0 \uc5f0\ub77d\ud558\uae30 \uadc0\ucc2e..."}),". 2\ubc88 \ubc29\ubc95\uc73c\ub85c \uc9c4\ud589"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\uacb0\ub860\uc801\uc73c\ub85c \uc124\uce58 \uc21c\uc11c\n0. cert manager \uc124\uce58"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"opentelemetry operator"}),"\n",(0,t.jsx)(n.li,{children:"opentelemetry collector"}),"\n",(0,t.jsx)(n.li,{children:"opentelemetry instrument"}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"JVM \uc2e4\ud589 \uc2dc opentelemetry agent library\ub85c \uc2e4\ud589 \uc8fc\uc785"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"helm repo add"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add open-telemetry https://github.com/open-telemetry/opentelemetry-helm-charts\nhelm repo update\nhelm pull \n"})}),"\n",(0,t.jsxs)(n.h3,{id:"4-2-cert-manager-\uc124\uce58",children:["4-2. ",(0,t.jsx)(n.code,{children:"cert manager"})," \uc124\uce58"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"k8s \ub0b4\ubd80 TLS \ud1b5\uc2e0\uc5d0 \ub300\ud574 \uc778\uc99d \ucc98\ub9ac\ud558\ub294 \ubaa8\ub4c8\ub85c"}),"\n",(0,t.jsx)(n.li,{children:"\ud1b5\uc0c1 self-signed TLS \uc778\uc99d\uc11c\ub85c \ud1b5\uc2e0 \uac00\ub2a5\ud558\ub3c4\ub85d \uc124\uc815\ud574 \uc90c"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# default \uc124\uce58\nkubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.161/cert-manager.yaml \n\n# \uc124\uce58 \ud655\uc778\n$ k get po -n \nNAME                                        READY   STATUS  RESTART AGE\ncert-manager-54f448d676d-cgznw              1/1     Running 0       10d\ncert-manager-cainjector-7fc66c5787-gbpjk    1/1     Running 0       10d\ncert-manager-webhook-fb4d6fb7-7zn7j         1/1     Running 0       10d\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"4-3-opentelemetry-operator-\uc124\uce58",children:["4-3. ",(0,t.jsx)(n.code,{children:"opentelemetry operator"})," \uc124\uce58"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ${WORKDIR}/opentelemetry-helm-charts/charts/opentelemetry-operator\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"4-3-1-valuesyaml-\ud3b8\uc9d1\ub0b4\uc6a9",children:["4-3-1. ",(0,t.jsx)(n.code,{children:"values.yaml"})," \ud3b8\uc9d1\ub0b4\uc6a9"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'## \ubcc0\uacbd \ub0b4\uc6a9 : image repostiroy \n....(\uc911\ub7b5)....\nmanager:\n  image:\n    repository: sharedprdacr.azureacr.io/open-telemetry/opentelemetry-operator/opentelemetry-operator\n    tag: ""\n  collectorImage:\n    repository: sharedprdacr.azureacr.io/open-telemetry/opentelemetry-operator/opentelemetry-collector\n    tag: 0.110.0\n....(\uc0dd\ub7b5)....\n\nkubeRBACProxy:\n  image:\n    repository: sharedprdacr.azureacr.io/brancz/kube-rbac-proxy\n\n'})}),"\n",(0,t.jsxs)(n.h4,{id:"4-3-2-opentelemetry-collector-\uc124\uce58",children:["4-3-2. ",(0,t.jsx)(n.code,{children:"opentelemetry-collector"})," \uc124\uce58"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"values.yaml \ud3b8\uc9d1"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'....(\uc0dd\ub7b5) - tempo \uc124\uc815....\nmode: "deployment" # deployment\ub85c \ubcc0\uacbd\nconfig:\n  exporters:\n    otlp:\n      endpoint: "http://tempo.ns-prometheus.svc.cluster.local:4317"  ## tempo\ub97c \uc774\uc6a9\ud560 \uac83\uc73c\ub85c exporter\ub85c tempo\ub97c \uc9c0\uc815 , Tempo \uc124\uce58\ub294 \ub2e4\uc74c\uc808 \ucc38\uc870\n      tls:\n        insecure: true\n# \ubcc0\uacbd \uc0ac\ud56d\uc740 \uc544\ub2c8\uc9c0\ub9cc, \uc911\uc694 \uc124\uc815 \n  processors:\n    batch: {} \n    memory_limiter:\n      check_interval: 5s\n      limit_percentage: 80\n      spike_limit_percentage: 25\n  receivers:\n    jaeger: # jaeger\n      protocols: \n        grpc: \n          endpoint: ${env:MY_POD_PI}:14250\n        thrift_http:\n          endpoint: ${env:MY_POD_IP}:14268\n        thrift_compact:\n          endpoint: ${env:MY_POD_IP}:6831\n    otlp: # otlp\n      protocols:\n        grpc:\n          endpoint: ${env:MY_POD_IP}:4317\n        http:\n          endpoint: ${env:MY_POD_IP}:4318\n    prometheus:\n      config:\n        scrape_configs:\n        - job_name: opentelemetry_collector\n          scrape_interval: 10s\n          static_configs:\n          - targets:\n            - ${env:MY_POD_IP}:8888\n    zipkin:\n      endpoint: ${env:MY_POD_IP}:9411\n  service:\n    telemetry:\n      metrics:\n        address: ${env:MY_POD_IP}:8888\n    extensions:\n      - health_check\n    pipelines:\n      logs:\n        exportors:\n          - debug\n        processors:\n          - memory_limiter\n          - batch\n        receivers:\n          - otlp\n      metrics:\n        exporters:\n          - debug\n        processors:\n          - memory_limiter\n          - batch\n        receivers:\n          - otlp\n          - prometheus\n      traces:\n        exportoers:\n          - debug\n        processors:\n          - memory_limiter\n          - batch\n        receivers:\n          - otlp\n          - jaeger\n          - zipkin\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"helm install"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ${WORKDIR}/opentelemetry-helm-charts/charts/opentelemetry-collector\nhelm upgrade --install otel-collector . -f values.yaml\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"4-4-opentelemetry-instatruments-\uc124\uc815",children:["4-4. ",(0,t.jsx)(n.code,{children:"opentelemetry-instatruments"})," \uc124\uc815"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"instruments \uc124\uc815 \ubc29\ubc99\uc5d0\ub294 \uc5ec\ub7ec \uac00\uc9c0\uac00 \uc788\uc73c\uba70, \uc55e\uc11c \uc0b4\ud3b4\ubcf8 \ubc14\uc640 \uac19\uc774 auto-instruments\ub97c \uc124\uc815\ud558\uc5ec resource \uc0dd\uc131 \uc2dc tag\ub97c \ud65c\uc6a9\ud558\uc5ec \uc790\ub3d9 \uc8fc\uc785\ub418\ub294 \ud658\uacbd\uc740 \uc544\ub2c8\ub2e4."}),"\n",(0,t.jsxs)(n.li,{children:["\ud574\ub2f9 \uc124\uc815\uc744 \uc704\ud574\uc11c\ub294 ",(0,t.jsx)(n.strong,{children:"certManager Webhook"})," \uc124\uc815\uc774 \ud544\uc694\ud558\uba70 \uc774\ub294 ",(0,t.jsx)(n.strong,{children:"cluster \uc758 8443 port open \ud544\uc694"})]}),"\n",(0,t.jsx)(n.li,{children:"\uc5ec\uae30\uc11c\ub294 instrument\ub97c \ubcc4\ub3c4\ub85c \uc124\uce58\ud558\uc9c0 \uc54a\uace0, \ubcf4\ub0b4\ub294 \uc11c\ube44\uc2a4\uc5d0\uc11c lib \ud30c\uc77c\uc744 agent \ud615\ud0dc\ub85c \ucd94\uac00\ud558\uc5ec collector\uc5d0 \uc804\uc1a1\ud558\ub294 \ubc29\ubc95\uc744 \ud0dd\ud588\ub2e4."}),"\n",(0,t.jsx)(n.li,{children:"\ucc38\uace0 \uc0ac\ud56d\uc73c\ub85c auto-instruments \uc124\uc815\uc744 \uc704\ud55c manifests \ud30c\uc77c\uc740 \uc544\ub798\uc640 \uac19\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"4-4-1-\ucc38\uace0-otel-instrumentation",children:"4-4-1. [\ucc38\uace0] otel-instrumentation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: opentelemetry.io/v1alpha1\nkind: Instrumentation\nmetadata:\n  name: otel-instrumentation \nspec:\n  exporter:\n    endpoint: " http://otel-collector-opentelemetry-collector.ns-prometheus:4317"\n  propagators:\n    - tracecontext\n    - baggage\n  sampler:\n    type: parentbased_traceidratio\n    argument: "0.25"\n  python:\n    env:\n    - name: OTEL_EXPORTER_OTLP_ENDPOINT\n      value: http://otel-collector-opentelemetry-collector.ns-prometheus:4318\n  dotnet:\n    env:\n    - name: OTEL_EXPORTER_OTLP_ENDPOINT\n      value: http://otel-collector-opentelemetry-collector.ns-prometheus:4318\n  go:\n    env:\n    - name: OTEL_EXPORTER_OTLP_ENDPOINT\n      value: http://otel-collector-opentelemetry-collector.ns-prometheus:4318\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"[\ucc38\uace0] otel-instrumentation \uc124\uce58\ub97c \uc704\ud55c \uba85\ub839\uc5b4"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'kubectl config use-context <<cluster-context>>;\nhelm upgrade --install --set "manager.collectorImage.repository=sharedprdacr.azureacr.io/opentelemetry-collector-k8s" \\\n                       --set "admissionWebhooks.certManager.enabled=false \\ \n                       --set admissionWebhooks.autoGenerateCert.enabled=true\n                       opentelemetry-operator . -f values.yaml -n ns-prometheus \n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"[\ucc38\uace0] otel operator \uc7ac\uc124\uce58\ud560 \uacbd\uc6b0 \uc0ad\uc81c\uac00 \ud544\uc694\ud55c CRD \ubaa9\ub85d"}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\ub300\uc0c1"}),(0,t.jsx)(n.th,{children:"\uc0ad\uc81c \uba85\ub839"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"instrumentations.opentelemetry.io"}),(0,t.jsx)(n.td,{children:"kubectl delete crd instrumentations.opentelemetry.io"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"opampbridges.opentelemetry.io"}),(0,t.jsx)(n.td,{children:"kubectl delete crd opampbridges.opentelemetry.ioopampbridges.opentelemetry.io"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"opentelemetrycollectors.opentelemetry.io"}),(0,t.jsx)(n.td,{children:"kubectl delete crd opentelemetrycollectors.opentelemetry.io"})]})]})]}),"\n",(0,t.jsxs)(n.h2,{id:"5-tempo-\uc124\uce58",children:["5. ",(0,t.jsx)(n.code,{children:"Tempo"})," \uc124\uce58"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Tempo\ub294 ",(0,t.jsx)(n.code,{children:"trace"})," \ub97c \uc704\ud55c OSS library \uc911 \ud558\ub098\ub85c grafana community version\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5"]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"5-1-valuesyaml-\ud3b8\uc9d0",children:["5-1. ",(0,t.jsx)(n.code,{children:"values.yaml"})," \ud3b8\uc9d0"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'....(\uc0dd\ub7b5)....\ntempo:\n  metricsGenerator:\n    enabled: true\n    repoteWriteUrl: "http://prometheus-kube-promethus-prometheus.ns-prometheus:9090/api/v1/write"\n  ........\n  retention: 24h\n  storage:\n    trace:\n      backend: azure\n      azure:\n        container_name: grafana-tempo\n        storage_account_name: <<STORAGE_ACCOUNT_NAME>>\n        storage_account_key: <<STORAGE_ACCOUNT_KEY>>\n      local:\n        path: /var/tempo/traces\n      wal:\n        path: /var/tempo/wal\n  receivers:\n    opencensus:\n    otlp:\n      protocols:\n        grpc:\n          endpoint: "0.0.0.0:4317"\n        http:\n          endpoint: "0.0.0.0:4318"\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"5-2-tempo-install",children:["5-2. ",(0,t.jsx)(n.code,{children:"Tempo"})," install"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ${WORKDIR}/grafana-stack/charts/tempo\nkubectl config use-context <<cluster-context>>; helm upgrade --install tempo . -n ns-prometheus\n"})}),"\n",(0,t.jsx)(n.h2,{id:"6-exporter-\uc124\uce58",children:"6. Exporter \uc124\uce58"}),"\n",(0,t.jsxs)(n.h3,{id:"6-1-postgresql-exporter-\uc124\uce58",children:["6-1. ",(0,t.jsx)(n.code,{children:"postgresql-exporter"})," \uc124\uce58"]}),"\n",(0,t.jsx)(n.h4,{id:"6-1-1-\uc124\uc815-\uac12-\ubcc0\uacbd",children:"6-1-1. \uc124\uc815 \uac12 \ubcc0\uacbd"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'image:\n  registry: quay.io\n  repository: prometheuscommunity/postgres-exporter\n\nservice:\n  type: ClusterIP\n  port: 80\n  targetPort: 9187\n  name: http\n  labels: {}\n  annotaions: \n    prometheus.io/path: /metrics\n    prometheus.io/scrape: "true"\nserviceMonitor:\n  enabled: true\n  namespace: ns-prometheus\n  interval: 30s\n  telemetryPath: /metrics\n  labels: pg-dev\n  timeout: 10s\nprometheusRule:\n  enabled: false\n'})}),"\n",(0,t.jsxs)(n.h4,{id:"6-1-2-postgresql-exporter-\uc124\uce58",children:["6-1-2. ",(0,t.jsx)(n.code,{children:"postgresql-exporter"})," \uc124\uce58"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ${WORKDIR}/postgres_exporter/prometheus-postgre-exporter\nhelm upgrade --install prometheus-postgres-exporter . -f postgre-exporter.yaml -n ns-prometheus \n"})}),"\n",(0,t.jsxs)(n.h4,{id:"6-1-3-prometheus-exporter-\uc124\uc815",children:["6-1-3. ",(0,t.jsx)(n.code,{children:"prometheus exporter"})," \uc124\uc815"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# prometheus config \n....\nprometheusSpec:\n  additionalScrapeConfigs:\n  ## for pg\n  - job_name: pg_exporter\n    metrics_path: /metrics\n    scrape_interval: 60s\n    scrape_timeout: 30s\n    static_configs:\n    - targets:\n      - prometheus-postgres-exporter:80\n  ## for redis \n  - job_name: redisexporter\n    static_configs:\n    - targets:\n      - redis-exporter-prometheus-reids-exporter:9121\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"6-2-redis-exporter-\uc124\uce58",children:["6-2. ",(0,t.jsx)(n.code,{children:"redis-exporter"})," \uc124\uce58"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["oliver006/redis_exporter \ud65c\uc6a9 : ",(0,t.jsx)(n.a,{href:"https://github.com/oliver006/redis_exporter",children:"github\uc8fc\uc18c"})]}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"6-2-1-valuesyaml-\ud3b8\uc9d1",children:["6-2-1. ",(0,t.jsx)(n.code,{children:"values.yaml"})," \ud3b8\uc9d1"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# \ud655\uc778 \nservice:\n  type: ClusterIP\n  port: 9121\n  portName: redis-exporter\n"})}),"\n",(0,t.jsx)(n.h2,{id:"7-\ucc38\uace0-\uc0ac\uc774\ud2b8",children:"7. [\ucc38\uace0 \uc0ac\uc774\ud2b8]"}),"\n",(0,t.jsx)(n.h2,{id:"8-epilog",children:"8. Epilog"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["k8s \uc11c\ube44\uc2a4 \ub178\ucd9c\uc744 L7 LB\ub97c \ud1b5\ud558\uc5ec ",(0,t.jsx)(n.code,{children:"domain"}),"\uc744 \uc5f4\uc5b4\uc57c \ud558\ub294 \uad6c\uc870\uc778\ub370, \ud574\ub2f9 \uae30\ub2a5 \uc2b9\uc778\uc744 \uc815\ubcf4\ubcf4\uc548\ud300\uc5d0\uc11c \ub2f4\ub2f9\ud558\uc5ec, \ud558\ub098 ",(0,t.jsx)(n.code,{children:"domain"})," \ud574\uc81c\ud558\uae30 \uae4c\ub2e4\ub86d\uace0 \uc808\ucc28\ub3c4 \uc624\ub798 \uac78\ub824, ",(0,t.jsx)(n.code,{children:"manifest"})," \ud30c\uc77c\uc744 ",(0,t.jsx)(n.del,{children:"\ud55c\ub540 \ud55c\ub540 \uc218\uc815\ud558\uc5ec"})," \uad6c\ucd95\ud558\uc600\uc73c\ub098 ",(0,t.jsx)(n.del,{children:"\uc0bd\uc9c8 \uc778\ub4ef..."})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"multi-cluster"})," \uc801\uc6a9\uacfc multicluster\ub97c \ud1b5\ud569\ud55c ",(0,t.jsx)(n.code,{children:"Thanos"})," \uc801\uc6a9\uae30\ub3c4 \ucd94\uac00\ud560 \uc608\uc815\uc774\ub2e4."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var l=r(6540);const t={},s=l.createContext(t);function o(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),l.createElement(s.Provider,{value:n},e.children)}},3736:e=>{e.exports=JSON.parse('{"permalink":"/2024/12/18/forth-prometheus","source":"@site/blog/2024-12-18-forth-prometheus.md","title":"Setup Prometheus on private k8s cluster","description":"summary","date":"2024-12-17T16:16:01.000Z","tags":[{"inline":false,"label":"Observability","permalink":"/tags/Observability","description":"Observability tag description"},{"inline":false,"label":"Prometheus","permalink":"/tags/Prometheus","description":"Prometheus tag description"},{"inline":false,"label":"Loki","permalink":"/tags/Loki","description":"Loki tag description"},{"inline":false,"label":"Tempo","permalink":"/tags/Tempo","description":"Tempo tag description"},{"inline":false,"label":"Opentelemetry","permalink":"/tags/Opentelemetry","description":"Opentelemetry tag description"},{"inline":false,"label":"auto-instrument","permalink":"/tags/auto-instrument","description":"auto-instrument tag description"}],"readingTime":11.37,"hasTruncateMarker":true,"authors":[{"name":"Hanbyul Cho","title":"Engineer","url":"https://github.com/hansgun","page":{"permalink":"/authors/hansgun"},"socials":{"linkedin":"https://www.linkedin.com/in/hanbyulcho1/","github":"https://github.com/hansgun"},"imageURL":"https://github.com/hansgun.png","key":"hansgun"}],"frontMatter":{"layout":"single","title":"Setup Prometheus on private k8s cluster","date":"2024-12-17 16:16:01 -0600","categories":"work","tags":["Observability","Prometheus","Loki","Tempo","Opentelemetry","auto-instrument"],"author_profile":false,"toc":true,"toc_label":"On This Page","toc_icon":"cog","toc_position":"sticky","authors":["hansgun"]},"unlisted":false,"prevItem":{"title":"Hello World!","permalink":"/helllo_world"},"nextItem":{"title":"Redis A-S(Active-Standby/Master-Slave) cluster \uad6c\ucd95\uae30","permalink":"/2024/11/01/fifth-Redis-cluster"}}')}}]);