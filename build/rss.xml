<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="rss.xsl"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Han's blog Blog</title>
        <link>https://hansgun.github.io/</link>
        <description>Han's blog Blog</description>
        <lastBuildDate>Sat, 28 Dec 2024 12:04:31 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Hello World!]]></title>
            <link>https://hansgun.github.io/helllo_world</link>
            <guid>https://hansgun.github.io/helllo_world</guid>
            <pubDate>Sat, 28 Dec 2024 12:04:31 GMT</pubDate>
            <description><![CDATA[Hello !]]></description>
            <content:encoded><![CDATA[<p>Hello !</p>
<p>어제(24.12.28) 만들었네요</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Setup Prometheus on private k8s cluster]]></title>
            <link>https://hansgun.github.io/2024/12/18/forth-prometheus</link>
            <guid>https://hansgun.github.io/2024/12/18/forth-prometheus</guid>
            <pubDate>Tue, 17 Dec 2024 16:16:01 GMT</pubDate>
            <description><![CDATA[summary]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>summary</p>
</blockquote>
<ul>
<li>상용 SaaS Observability 툴은 modern한 그래픽과 편의성을 제공하지만(ex<!-- -->:Datadog<!-- -->), 사용량 base로 과금으로 최적화 하지 않은 Log, Trace 혹은 Profile 기능을 활용 시 과금 폭탄을 맞고 있다.</li>
<li>Open Source 이자, k8s 환경에 잘 적용되고, 빠르게 발전중인 Prometheus로 대체 하고자 현 운영중인 private k8s cluster에 prometheus stack을 적용한 이야기를 적어본다.</li>
<li><code>trace</code> 기능 구현을 search 하던 중 <code>open-telemetry</code> 를 발견하였으며, 다시 구축한다면 <code>opentelemetry stack</code> 을 활용하여 scratch 부터 구성하겠지만, <code>kube-prometheus-stack</code> 의 편리함을 한 번 맛보고 <del>나니 돌아가고 싶지 않다.</del></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="0-구성요소---설치한-내용">0. 구성요소 - 설치한 내용<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#0-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C---%EC%84%A4%EC%B9%98%ED%95%9C-%EB%82%B4%EC%9A%A9" class="hash-link" aria-label="Direct link to 0. 구성요소 - 설치한 내용" title="Direct link to 0. 구성요소 - 설치한 내용">​</a></h2>
<hr>
<ul>
<li>Prometheus - [ kube-prometheus-stack ]</li>
<li>Loki - for log</li>
<li>Tempo, Opentelemetry Agent - for trace</li>
<li>Exporters - Redis, PostgreSQL</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-1-trace-설정-관련">0-1. Trace 설정 관련<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#0-1-trace-%EC%84%A4%EC%A0%95-%EA%B4%80%EB%A0%A8" class="hash-link" aria-label="Direct link to 0-1. Trace 설정 관련" title="Direct link to 0-1. Trace 설정 관련">​</a></h3>
<ul>
<li>고려한 솔루션은 <code>Jaeger</code>, <code>Zipkin</code>, <code>Tempo</code> 등이 있으며, 앞의 2개 솔루션은 몇 가지 단점이 있으며 사실 상 deprecated 되어 Tempo를 활용하기로 결정<!-- -->
<ul>
<li><code>Jeager</code> : CNCF 등록 프로젝트이나, 설정이 복잡함</li>
<li><code>Zipkin</code> : Java 진영의 Trace용 솔루션으로, 커뮤니티 활성화가 되어 있지 않아 이슈 해결의 어려움.</li>
<li><code>Tempo</code> : 상대적으로 신생 프로젝트이나 <code>Grafana</code> 진영에서 주 프로젝트로 관리하고, <code>Grafana</code> 생태계와 연동하기 좋음. <del>UI! 짱</del></li>
</ul>
</li>
<li><code>Opentelemetry Auto-instruments</code>를 이용해 Trace data를 주입하고자 하였으나, <code>8443 port</code>를 k8s cluster node 단에서 오픈이 필요하여 이 부분은 생략함. <del>사실 namespace별, service별 operator 배포가 귀찮은 것도..</del></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-환경-설정">1. 환경 설정<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#1-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 1. 환경 설정" title="Direct link to 1. 환경 설정">​</a></h2>
<hr>
<ul>
<li>필요 프로그램</li>
<li>k8s agent - connecto to cluster</li>
<li>helm</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-1-다운로드-환경">1-1. 다운로드 환경<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#1-1-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-%ED%99%98%EA%B2%BD" class="hash-link" aria-label="Direct link to 1-1. 다운로드 환경" title="Direct link to 1-1. 다운로드 환경">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-1-1-docker-image-download">1-1-1. docker image download<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#1-1-1-docker-image-download" class="hash-link" aria-label="Direct link to 1-1-1. docker image download" title="Direct link to 1-1-1. docker image download">​</a></h4>
<ul>
<li>private cluster 에서 public docker image download가 불가능 하므로, CI/CD Agent 서버에서 이미지 다운로드 후 proxy 서버(Azure Artifacts)에 등록하여 k8s cluster에 설치 함</li>
<li>예제</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## sharedprdacr.azureacr.io 에 docker login 되어 있어야 함.. azure service account 로 가능 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## 1. download</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull docker.io/grafana/grafana:11.2.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## 2. taggging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> tag docker.io/grafana/grafana:11.2.0 sharedprdacr.azureacr.io/grafana/grafana:11.2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> tag registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6 sharedprdacr.azureacr.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## 3. push </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> push sharedprdacr.azureacr.io/grafana/grafana:11.2.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> push sharedprdacr.azureacr.io/ingress-nginx/kube-webhook-certgen:v20221220-controller-v1.5.1-58-g787ea74b6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-install-kube-prometheus-stack">2. install kube-prometheus-stack<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#2-install-kube-prometheus-stack" class="hash-link" aria-label="Direct link to 2. install kube-prometheus-stack" title="Direct link to 2. install kube-prometheus-stack">​</a></h2>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-1-helm-chart-download">2-1. helm chart download<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#2-1-helm-chart-download" class="hash-link" aria-label="Direct link to 2-1. helm chart download" title="Direct link to 2-1. helm chart download">​</a></h3>
<ul>
<li>kube-prometheus-stack 설치</li>
<li>namespace 명 : <code>ns-prometheus</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /data/mgmt/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### repo add</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> prometheus-community https://prometheus-community.github.io/helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### helm pull</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${WORKDIR}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm pull prometheus-community/kube-prometheus-stack </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-2-edit-valuesyaml">2-2. edit values.yaml<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#2-2-edit-valuesyaml" class="hash-link" aria-label="Direct link to 2-2. edit values.yaml" title="Direct link to 2-2. edit values.yaml">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stack/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## values.yaml 백업</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp values.yaml values_241217.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### vi 로 values.yaml 파일 편집</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## docker registry 변경</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">global.imageRegistry</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"sharedacr.azureacr.io"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">global.imagePullSecrets</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">XXXXXXXX</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## alert manager off </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">alertmanager.enabled</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">s/(docker.io</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">registry.k8s.io</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">quay.io</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">gcr.io</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">ghcr.io)/shared.azureacr.io/g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## grafana : k8s service 로 등록 예정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-3-install-prometheus">2-3. install prometheus<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#2-3-install-prometheus" class="hash-link" aria-label="Direct link to 2-3. install prometheus" title="Direct link to 2-3. install prometheus">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain">cluster context</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> prometheus </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus --create-namespace </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-log-설정">3. Log 설정<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-log-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 3. Log 설정" title="Direct link to 3. Log 설정">​</a></h2>
<hr>
<ul>
<li>loki를 통하여 log를 전달 받아 cloud에 Object storage 에 저장하는 로직을 구현.</li>
<li>Loki에서는 cloud storage 설정, promtail 은 loki와 연결하는 인터페이스 설정이 필요</li>
<li>설정을 위한 helm chart는 grafana를 이용하므로 개별 설정 변경 전에 먼저 다운 받아 둔다.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## helm repo add</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> grafana https://grafana.github.io/helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm pull grafana-stack </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-1-loki-설정">3-1. Loki 설정<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-1-loki-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 3-1. Loki 설정" title="Direct link to 3-1. Loki 설정">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-1-1-워킹-디렉터리-변경">3-1-1. 워킹 디렉터리 변경<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-1-1-%EC%9B%8C%ED%82%B9-%EB%94%94%EB%A0%89%ED%84%B0%EB%A6%AC-%EB%B3%80%EA%B2%BD" class="hash-link" aria-label="Direct link to 3-1-1. 워킹 디렉터리 변경" title="Direct link to 3-1-1. 워킹 디렉터리 변경">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${WORKDIR}</span><span class="token plain">/grafana-stack/charts/loki-distributed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-1-2-valuesyaml-파일-편집">3-1-2. <code>values.yaml</code> 파일 편집<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-1-2-valuesyaml-%ED%8C%8C%EC%9D%BC-%ED%8E%B8%EC%A7%91" class="hash-link" aria-label="Direct link to 3-1-2-valuesyaml-파일-편집" title="Direct link to 3-1-2-valuesyaml-파일-편집">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">(생략)..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">schemaConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2024-09-11"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">index</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">period</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 24h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">prefix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> index_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">object_store</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> azure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">store</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tsdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">storageConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">azure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">account_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;스토리지이름</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">account_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BO1dfASaldkjfklUXAlkjasldkfjalskjf==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">use_managed_identity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">request_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tsdb_shipper</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">active_index_directory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> var/loki/index </span><span class="token comment" style="color:#999988;font-style:italic">### var 앞에 / 추가할 경우 에러 발생</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cache_location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> var/loki/index_cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cache_ttl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 24h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">filesystem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">directory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> var/loki/chunks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">(하략)</span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-1-3-loki-distributed-install">3-1-3. loki-distributed install<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-1-3-loki-distributed-install" class="hash-link" aria-label="Direct link to 3-1-3. loki-distributed install" title="Direct link to 3-1-3. loki-distributed install">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## k8s context 선택</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cluster-context</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## install </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> loki </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-1-4-loki-설치-확인">3-1-4. Loki 설치 확인<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-1-4-loki-%EC%84%A4%EC%B9%98-%ED%99%95%EC%9D%B8" class="hash-link" aria-label="Direct link to 3-1-4. Loki 설치 확인" title="Direct link to 3-1-4. Loki 설치 확인">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ k get po </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> loki </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                        READY   STATUS  RESTART AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loki-loki-distritubed-gateway-6dc5578cb9-j7scf              </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loki-loki-distritubed-distributor-6dc5578cb9-j7scf          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loki-loki-distritubed-ingester-0                            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loki-loki-distritubed-querier-0                             </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loki-loki-distritubed-query-frontend-8689676f4f-h8wn4-0     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-2-promtail-설정">3-2. promtail 설정<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-2-promtail-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 3-2. promtail 설정" title="Direct link to 3-2. promtail 설정">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-2-1-워킹-디렉터리-변경">3-2-1. 워킹 디렉터리 변경<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-2-1-%EC%9B%8C%ED%82%B9-%EB%94%94%EB%A0%89%ED%84%B0%EB%A6%AC-%EB%B3%80%EA%B2%BD" class="hash-link" aria-label="Direct link to 3-2-1. 워킹 디렉터리 변경" title="Direct link to 3-2-1. 워킹 디렉터리 변경">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$WORKDIR</span><span class="token plain">/grafana-stack/charts/promtail</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-2-2-valuesyaml-파일-편집">3-2-2. <code>values.yaml</code> 파일 편집<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-2-2-valuesyaml-%ED%8C%8C%EC%9D%BC-%ED%8E%B8%EC%A7%91" class="hash-link" aria-label="Direct link to 3-2-2-valuesyaml-파일-편집" title="Direct link to 3-2-2-valuesyaml-파일-편집">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.(생략)</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">clients</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//loki</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">loki</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">distributed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gateway/loki/api/v1/push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.(하략)</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-2-3-install-promtail">3-2-3. <code>install promtail</code><a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-2-3-install-promtail" class="hash-link" aria-label="Direct link to 3-2-3-install-promtail" title="Direct link to 3-2-3-install-promtail">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgradee </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> promtail </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>[to-do] multi-line 처리</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-3-promtail-설치-확인">3-3. promtail 설치 확인<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#3-3-promtail-%EC%84%A4%EC%B9%98-%ED%99%95%EC%9D%B8" class="hash-link" aria-label="Direct link to 3-3. promtail 설치 확인" title="Direct link to 3-3. promtail 설치 확인">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ k get po </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> promtail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    READY   STATUS  RESTART AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promtail-2f8v9          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promtail-2f8v9          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promtail-2f8v9          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promtail-2f8v9          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promtail-2f8v9          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promtail-2f8v9          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-trace-설정">4. <code>Trace</code> 설정<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-trace-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 4-trace-설정" title="Direct link to 4-trace-설정">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-0-opentelemetry-개요">4-0. opentelemetry 개요<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-0-opentelemetry-%EA%B0%9C%EC%9A%94" class="hash-link" aria-label="Direct link to 4-0. opentelemetry 개요" title="Direct link to 4-0. opentelemetry 개요">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-1-설치-순서">4-1. 설치 순서<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-1-%EC%84%A4%EC%B9%98-%EC%88%9C%EC%84%9C" class="hash-link" aria-label="Direct link to 4-1. 설치 순서" title="Direct link to 4-1. 설치 순서">​</a></h3>
<ul>
<li>
<p>먼저 opentelemetry 설치 전에 cert manager를 설치필요(requirement)</p>
</li>
<li>
<p>opentelemetry trace는 CRD 형태로 배포 후 operator resource를 설치하고 collector 서비스를 기동하여 수집을 위한 환경을 만든다.</p>
</li>
<li>
<p>앞서 생성한 collector에 실제 trace 데이터를 전송하는 agent는 몇 가지 방법으로 설치할 수 있는데, CI/CD pipeline을 통해 자동화하려면 크게 2가지 방법으로 정리된다.</p>
<ol>
<li>autoinstrument k8s object를 생성하여 label selector를 통하여 자동 적용</li>
<li>opentelemery agent를 JVM 구동 시 library 형태로 주입하고, 설정에 필요한 환경변수들은 helm 배포 시 주입되도록 조작</li>
</ol>
</li>
<li>
<p>앞선 방법 중 1번의 경우 cert manager와 통신을 위해서 k8s cluster nodeport 에 대해 open이 필요하나(<code>port : 8443</code>) private cluster의 방화벽 open 필요. <del>정보보안팀에 연락하기 귀찮...</del>. 2번 방법으로 진행</p>
</li>
<li>
<p>결론적으로 설치 순서
0. cert manager 설치</p>
<ol>
<li>opentelemetry operator</li>
<li>opentelemetry collector</li>
<li>opentelemetry instrument</li>
</ol>
<ul>
<li>JVM 실행 시 opentelemetry agent library로 실행 주입</li>
</ul>
</li>
<li>
<p>helm repo add</p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> open-telemetry https://github.com/open-telemetry/opentelemetry-helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm pull </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-2-cert-manager-설치">4-2. <code>cert manager</code> 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-2-cert-manager-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 4-2-cert-manager-설치" title="Direct link to 4-2-cert-manager-설치">​</a></h3>
<ul>
<li>k8s 내부 TLS 통신에 대해 인증 처리하는 모듈로</li>
<li>통상 self-signed TLS 인증서로 통신 가능하도록 설정해 줌</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># default 설치</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> https://github.com/cert-manager/cert-manager/releases/download/v1.161/cert-manager.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 설치 확인</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ k get po </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        READY   STATUS  RESTART AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert-manager-54f448d676d-cgznw              </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert-manager-cainjector-7fc66c5787-gbpjk    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert-manager-webhook-fb4d6fb7-7zn7j         </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       10d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-3-opentelemetry-operator-설치">4-3. <code>opentelemetry operator</code> 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-3-opentelemetry-operator-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 4-3-opentelemetry-operator-설치" title="Direct link to 4-3-opentelemetry-operator-설치">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${WORKDIR}</span><span class="token plain">/opentelemetry-helm-charts/charts/opentelemetry-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-3-1-valuesyaml-편집내용">4-3-1. <code>values.yaml</code> 편집내용<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-3-1-valuesyaml-%ED%8E%B8%EC%A7%91%EB%82%B4%EC%9A%A9" class="hash-link" aria-label="Direct link to 4-3-1-valuesyaml-편집내용" title="Direct link to 4-3-1-valuesyaml-편집내용">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## 변경 내용 : image repostiroy </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.(중략)</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">manager</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sharedprdacr.azureacr.io/open</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">telemetry/opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">operator/opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">collectorImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sharedprdacr.azureacr.io/open</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">telemetry/opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">operator/opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.110.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.(생략)</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kubeRBACProxy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sharedprdacr.azureacr.io/brancz/kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">rbac</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-3-2-opentelemetry-collector-설치">4-3-2. <code>opentelemetry-collector</code> 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-3-2-opentelemetry-collector-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 4-3-2-opentelemetry-collector-설치" title="Direct link to 4-3-2-opentelemetry-collector-설치">​</a></h4>
<ul>
<li>values.yaml 편집</li>
</ul>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.(생략) </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tempo 설정</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"deployment"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># deployment로 변경</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">exporters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">otlp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://tempo.ns-prometheus.svc.cluster.local:4317"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## tempo를 이용할 것으로 exporter로 tempo를 지정 , Tempo 설치는 다음절 참조</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">insecure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 변경 사항은 아니지만, 중요 설정 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">processors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">batch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory_limiter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">check_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limit_percentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spike_limit_percentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">receivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jaeger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># jaeger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocols</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">grpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_PI</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">14250</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">thrift_http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">14268</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">thrift_compact</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6831</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">otlp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># otlp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocols</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">grpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4317</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4318</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">scrape_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> opentelemetry_collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">scrape_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">static_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">zipkin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9411</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">telemetry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">MY_POD_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">extensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> health_check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pipelines</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">logs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">exportors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">processors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> memory_limiter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">receivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> otlp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">exporters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">processors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> memory_limiter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">receivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> otlp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">traces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">exportoers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">processors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> memory_limiter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">receivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> otlp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> jaeger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zipkin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>helm install</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${WORKDIR}</span><span class="token plain">/opentelemetry-helm-charts/charts/opentelemetry-collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> otel-collector </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-4-opentelemetry-instatruments-설정">4-4. <code>opentelemetry-instatruments</code> 설정<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-4-opentelemetry-instatruments-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 4-4-opentelemetry-instatruments-설정" title="Direct link to 4-4-opentelemetry-instatruments-설정">​</a></h3>
<ul>
<li>instruments 설정 방벙에는 여러 가지가 있으며, 앞서 살펴본 바와 같이 auto-instruments를 설정하여 resource 생성 시 tag를 활용하여 자동 주입되는 환경은 아니다.</li>
<li>해당 설정을 위해서는 <strong>certManager Webhook</strong> 설정이 필요하며 이는 <strong>cluster 의 8443 port open 필요</strong></li>
<li>여기서는 instrument를 별도로 설치하지 않고, 보내는 서비스에서 lib 파일을 agent 형태로 추가하여 collector에 전송하는 방법을 택했다.</li>
<li>참고 사항으로 auto-instruments 설정을 위한 manifests 파일은 아래와 같다.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-4-1-참고-otel-instrumentation">4-4-1. [참고] otel-instrumentation<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#4-4-1-%EC%B0%B8%EA%B3%A0-otel-instrumentation" class="hash-link" aria-label="Direct link to 4-4-1. [참고] otel-instrumentation" title="Direct link to 4-4-1. [참고] otel-instrumentation">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> opentelemetry.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Instrumentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> otel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">instrumentation </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" http://otel-collector-opentelemetry-collector.ns-prometheus:4317"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">propagators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tracecontext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> baggage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sampler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> parentbased_traceidratio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">argument</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.25"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">python</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OTEL_EXPORTER_OTLP_ENDPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//otel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector.ns</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4318</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dotnet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OTEL_EXPORTER_OTLP_ENDPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//otel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector.ns</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4318</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">go</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OTEL_EXPORTER_OTLP_ENDPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//otel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector.ns</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4318</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>[참고] otel-instrumentation 설치를 위한 명령어</p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain">cluster-context</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"manager.collectorImage.repository=sharedprdacr.azureacr.io/opentelemetry-collector-k8s"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> "admissionWebhooks.certManager.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">admissionWebhooks.autoGenerateCert.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       opentelemetry-operator </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> values.yaml </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>[참고] otel operator 재설치할 경우 삭제가 필요한 CRD 목록</p>
</blockquote>
<table><thead><tr><th>대상</th><th>삭제 명령</th></tr></thead><tbody><tr><td>instrumentations.opentelemetry.io</td><td>kubectl delete crd instrumentations.opentelemetry.io</td></tr><tr><td>opampbridges.opentelemetry.io</td><td>kubectl delete crd opampbridges.opentelemetry.ioopampbridges.opentelemetry.io</td></tr><tr><td>opentelemetrycollectors.opentelemetry.io</td><td>kubectl delete crd opentelemetrycollectors.opentelemetry.io</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-tempo-설치">5. <code>Tempo</code> 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#5-tempo-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 5-tempo-설치" title="Direct link to 5-tempo-설치">​</a></h2>
<ul>
<li>Tempo는 <code>trace</code> 를 위한 OSS library 중 하나로 grafana community version에서 확인 가능</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-1-valuesyaml-편짐">5-1. <code>values.yaml</code> 편짐<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#5-1-valuesyaml-%ED%8E%B8%EC%A7%90" class="hash-link" aria-label="Direct link to 5-1-valuesyaml-편짐" title="Direct link to 5-1-valuesyaml-편짐">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.(생략)</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tempo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metricsGenerator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repoteWriteUrl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://prometheus-kube-promethus-prometheus.ns-prometheus:9090/api/v1/write"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">retention</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 24h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">trace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> azure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">azure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grafana</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">tempo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storage_account_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;&lt;STORAGE_ACCOUNT_NAME</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storage_account_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;&lt;STORAGE_ACCOUNT_KEY</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/tempo/traces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">wal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/tempo/wal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">receivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">opencensus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">otlp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocols</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">grpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.0.0.0:4317"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.0.0.0:4318"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-2-tempo-install">5-2. <code>Tempo</code> install<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#5-2-tempo-install" class="hash-link" aria-label="Direct link to 5-2-tempo-install" title="Direct link to 5-2-tempo-install">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${WORKDIR}</span><span class="token plain">/grafana-stack/charts/tempo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain">cluster-context</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> tempo </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-exporter-설치">6. Exporter 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#6-exporter-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 6. Exporter 설치" title="Direct link to 6. Exporter 설치">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-1-postgresql-exporter-설치">6-1. <code>postgresql-exporter</code> 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#6-1-postgresql-exporter-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 6-1-postgresql-exporter-설치" title="Direct link to 6-1-postgresql-exporter-설치">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-1-1-설정-값-변경">6-1-1. 설정 값 변경<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#6-1-1-%EC%84%A4%EC%A0%95-%EA%B0%92-%EB%B3%80%EA%B2%BD" class="hash-link" aria-label="Direct link to 6-1-1. 설정 값 변경" title="Direct link to 6-1-1. 설정 값 변경">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> quay.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheuscommunity/postgres</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9187</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotaions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prometheus.io/path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prometheus.io/scrape</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">serviceMonitor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ns</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">telemetryPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pg</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">prometheusRule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-1-2-postgresql-exporter-설치">6-1-2. <code>postgresql-exporter</code> 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#6-1-2-postgresql-exporter-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 6-1-2-postgresql-exporter-설치" title="Direct link to 6-1-2-postgresql-exporter-설치">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${WORKDIR}</span><span class="token plain">/postgres_exporter/prometheus-postgre-exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> prometheus-postgres-exporter </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> postgre-exporter.yaml </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ns-prometheus </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-1-3-prometheus-exporter-설정">6-1-3. <code>prometheus exporter</code> 설정<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#6-1-3-prometheus-exporter-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 6-1-3-prometheus-exporter-설정" title="Direct link to 6-1-3-prometheus-exporter-설정">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># prometheus config </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">prometheusSpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">additionalScrapeConfigs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## for pg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pg_exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metrics_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scrape_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scrape_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">static_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">postgres</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## for redis </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redisexporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">static_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">reids</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9121</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-2-redis-exporter-설치">6-2. <code>redis-exporter</code> 설치<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#6-2-redis-exporter-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 6-2-redis-exporter-설치" title="Direct link to 6-2-redis-exporter-설치">​</a></h3>
<ul>
<li>oliver006/redis_exporter 활용 : <a href="https://github.com/oliver006/redis_exporter" target="_blank" rel="noopener noreferrer">github주소</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-2-1-valuesyaml-편집">6-2-1. <code>values.yaml</code> 편집<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#6-2-1-valuesyaml-%ED%8E%B8%EC%A7%91" class="hash-link" aria-label="Direct link to 6-2-1-valuesyaml-편집" title="Direct link to 6-2-1-valuesyaml-편집">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 확인 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9121</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">portName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-참고-사이트">7. [참고 사이트]<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#7-%EC%B0%B8%EA%B3%A0-%EC%82%AC%EC%9D%B4%ED%8A%B8" class="hash-link" aria-label="Direct link to 7. [참고 사이트]" title="Direct link to 7. [참고 사이트]">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-epilog">8. Epilog<a href="https://hansgun.github.io/2024/12/18/forth-prometheus#8-epilog" class="hash-link" aria-label="Direct link to 8. Epilog" title="Direct link to 8. Epilog">​</a></h2>
<ul>
<li>k8s 서비스 노출을 L7 LB를 통하여 <code>domain</code>을 열어야 하는 구조인데, 해당 기능 승인을 정보보안팀에서 담당하여, 하나 <code>domain</code> 해제하기 까다롭고 절차도 오래 걸려, <code>manifest</code> 파일을 <del>한땀 한땀 수정하여</del> 구축하였으나 <del>삽질 인듯...</del></li>
<li><code>multi-cluster</code> 적용과 multicluster를 통합한 <code>Thanos</code> 적용기도 추가할 예정이다.</li>
</ul>
<hr>]]></content:encoded>
            <category>Observability</category>
            <category>Prometheus</category>
            <category>Loki</category>
            <category>Tempo</category>
            <category>Opentelemetry auto-instrument</category>
        </item>
        <item>
            <title><![CDATA[Redis A-S(Active-Standby/Master-Slave) cluster 구축기]]></title>
            <link>https://hansgun.github.io/2024/11/01/fifth-Redis-cluster</link>
            <guid>https://hansgun.github.io/2024/11/01/fifth-Redis-cluster</guid>
            <pubDate>Fri, 01 Nov 2024 16:16:01 GMT</pubDate>
            <description><![CDATA[summary]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>summary</p>
</blockquote>
<ul>
<li>과제로 작성한 내용임</li>
<li>OSS DB 혹은 cache 솔루션은 성능, 효율성을 강조하는 대신, 정합성을 포함한 안정성에 대해서는 상용 제품들에 비해 기본 기능에서 제공하지 않는 경우가 많다.</li>
<li>고가용성 설정 Oracle RAC 등의 session failover 등의 detail 한 설정을 구현하기는 쉽지 않다.</li>
<li>OSS 레벨에서는 Primary에 문제가 생겼을 경우 Primary failover에 중점을 둔 replication 기반은 PSS 혹은 PSA 구조의 고가용성 구현이 지배적인 것 같다.</li>
<li>이러한 구조는 primary 운영에 이슈가 생겼을 경우 vote 하는 절차에서 의미 있는 결과를 도출하기 위하여 <code>quorum</code> 기반의 알고리즘 이 영향을 미친 것 같다.</li>
</ul>
<h1>1. Task 개요</h1>
<hr>
<ul>
<li>key-value store 이자 cache로 많이 활용되는 Redis 는 메모리 기반의 휘발성 저장 솔루션이다.</li>
<li>persistency를 위하여 RDBMS와 같이 저장장치에 데이터 동기화를 주기적으로 수행할 수 있으나 이 경우 메모리 상의 데이터 변경이 제한된다. 성능 저하 이슈도 발생한다.<!-- -->
<ul>
<li>최근에는 ahead logging 방식으로 sequential 하게 log를 기록하여 오버헤드를 줄이고, 이를 streaming 형태로 Standby 서버에 전송하여 준실시간 동기화를 통한 고가용성을 구현할 수 있다.</li>
</ul>
</li>
<li>sharding 과 같은 개념으로 key 값을 분산 처리 하여 부하 분산할 수 있도록 cluster 구성이 가능하다.</li>
<li>이에 대한 구현을 아래와 같이 진행하였다.</li>
<li>관리형 k8s cluster 에서 pod 형태로 redis cluster 구성과 모니터링을 구성하였다.</li>
</ul>
<ol>
<li>GKE 구성</li>
<li>Redis Cluster 구성</li>
</ol>
<ul>
<li><code>StatefulSet</code> 활용</li>
<li>Primary-Secondary 구조 구성</li>
</ul>
<ol start="3">
<li>Prometheus 설치</li>
</ol>
<ul>
<li>redis-exporter 설정</li>
</ul>
<ol start="4">
<li>redis 접근 application 생성 및 HA 접근 설정, key 분산 저장 여부 확인</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-1-구성도">1-1. 구성도<a href="https://hansgun.github.io/2024/11/01/fifth-Redis-cluster#1-1-%EA%B5%AC%EC%84%B1%EB%8F%84" class="hash-link" aria-label="Direct link to 1-1. 구성도" title="Direct link to 1-1. 구성도">​</a></h2>
<p><img decoding="async" loading="lazy" alt="redis cluster 구성도" src="https://hansgun.github.io/assets/images/cluster_archi-704a9a0b7f60e9b51892fb3134dfd6cc.png" width="673" height="602" class="img_ev3q"></p>
<h1>2. GKE 구성</h1>
<ul>
<li>GKE 구성은 <code>SDK</code> 설치 이후 <code>CLI</code> 를 통해 install 진행</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## env </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CLUSTER_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"gke-han-cluster"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ZONE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"asia-east1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NUM_NODES</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">MACHINE_TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"e2-medium"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth login q*****@gmail.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PROJECT_ID: ninth-age-4*****-p0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># NAME: My First Project</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PROJECT_NUMBER: 39*******</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PROJECT_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"your-project-id"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config </span><span class="token builtin class-name">set</span><span class="token plain"> project </span><span class="token variable" style="color:#36acaa">$PROJECT_ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services </span><span class="token builtin class-name">enable</span><span class="token plain"> container.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create </span><span class="token variable" style="color:#36acaa">$CLUSTER_NAME</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--zone</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ZONE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes </span><span class="token variable" style="color:#36acaa">$NUM_NODES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type </span><span class="token variable" style="color:#36acaa">$MACHINE_TYPE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-ip-alias </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--network</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"default"</span><span class="token plain"> --disk-size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">50GB </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--subnetwork</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"default"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-workload-identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud components </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters get-credentials </span><span class="token variable" style="color:#36acaa">$CLUSTER_NAME</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--zone</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ZONE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># add disk </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute disks create </span><span class="token parameter variable" style="color:#36acaa">--size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">10GB </span><span class="token parameter variable" style="color:#36acaa">--zone</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">asia-east1-a nfs-disk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>3. k8s 워크로드 구성</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-1-파일-구조">3-1. 파일 구조<a href="https://hansgun.github.io/2024/11/01/fifth-Redis-cluster#3-1-%ED%8C%8C%EC%9D%BC-%EA%B5%AC%EC%A1%B0" class="hash-link" aria-label="Direct link to 3-1. 파일 구조" title="Direct link to 3-1. 파일 구조">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree v1 </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 00.disk.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 01.sts.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 02.svc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 04.grafana_svc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── backup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>(작성중)</h1>
<h1>7. [참고 사이트]</h1>
<h1>Epilog</h1>
<ul>
<li></li>
</ul>
<hr>]]></content:encoded>
            <category>Redis Cluster</category>
            <category>kubernetes</category>
        </item>
        <item>
            <title><![CDATA[AKS terraform으로 시작해보기]]></title>
            <link>https://hansgun.github.io/2024/10/26/sixth-terrform-aks</link>
            <guid>https://hansgun.github.io/2024/10/26/sixth-terrform-aks</guid>
            <pubDate>Sat, 26 Oct 2024 16:16:01 GMT</pubDate>
            <description><![CDATA[summary]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>summary</p>
</blockquote>
<ul>
<li>Prometheus를 k8s cluster에 설치하는 실습을 진행하고자 설치 환경을 알아보던 중, Azure의 무료 credit이 있어 AKS를 설치해 보았다.</li>
<li>평소 실습해보고자 했던 <code>Terraform</code> 을 이용하여 Provisioning 하는 history를 기록에 남기고자 작성한 blog 이다.</li>
<li>실제 작업 후 2개월 이후에 작성하는 내용이라 기억이 가물가물 하다...</li>
</ul>
<h1>1. 개 요</h1>
<hr>
<ul>
<li>Prometheus - [ kube-prometheus-stack ]</li>
<li>Loki - for log</li>
<li>Tempo, Opentelemetry Agent - for trace</li>
<li>Exporters - Redis, PostgreSQL</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-1-파일-구조">1-1. 파일 구조<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-1-%ED%8C%8C%EC%9D%BC-%EA%B5%AC%EC%A1%B0" class="hash-link" aria-label="Direct link to 1-1. 파일 구조" title="Direct link to 1-1. 파일 구조">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── az_terra.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── 0_variables.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── 1_providers.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── 2_ssh.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── 3_main.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── 7_output.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── main.tfplan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── terraform.tfstate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── terraform.tfstate.backup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-2-전체-흐름---az_terrash">1-2. 전체 흐름 - <code>az_terra.sh</code><a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-2-%EC%A0%84%EC%B2%B4-%ED%9D%90%EB%A6%84---az_terrash" class="hash-link" aria-label="Direct link to 1-2-전체-흐름---az_terrash" title="Direct link to 1-2-전체-흐름---az_terrash">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">USERNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">********@hotmail.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az account list </span><span class="token parameter variable" style="color:#36acaa">--query</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"[?user.name=='********@hotmail.com'].{Name:name, ID:id, Default:isDefault}"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> Table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az group  list </span><span class="token parameter variable" style="color:#36acaa">--query</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"[?location=='koreacentral']"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"cloudName"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"AzureCloud"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"homeTenantId"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b42795af-74d2-****-*****-****"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"id"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"9e7c5e29-60c3-4a20-8afd-*********"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"isDefault"</span><span class="token builtin class-name">:</span><span class="token plain"> true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"managedByTenants"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"name"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Microsoft Azure 스폰서쉽 2"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"state"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Enabled"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"tenantId"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b42795af-74d2-****-*****-****"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"user"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"name"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"********@hotmail.com"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"type"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">MSYS_NO_PATHCONV</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az account </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--subscription</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"9e7c5e29-60c3-******-****-********"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az ad sp create-for-rbac </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> vmss_rbac </span><span class="token parameter variable" style="color:#36acaa">--role</span><span class="token plain"> Contributor </span><span class="token parameter variable" style="color:#36acaa">--scopes</span><span class="token plain"> /subscriptions/9e7c5e29-60c3-******-****-********</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"appId"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"a887e74b-****-4ae5-84d6-********"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"displayName"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vmss_rbac"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"password"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"q5b8Q~D&amp;&amp;&amp;&amp;&amp;&amp;*****jec_k"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"tenant"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b42795af-74d2-****-*****-****"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ARM_SUBSCRIPTION_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"9e7c5e29-60c3-******-****-********"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ARM_TENANT_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"b42795af-74d2-****-*****-****"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ARM_CLIENT_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"a887e74b-****-4ae5-84d6-********"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ARM_CLIENT_SECRET</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"q5b8Q~D&amp;&amp;&amp;&amp;&amp;&amp;*****jec_k"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az ad sp create-for-rbac </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">service_principal_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--role</span><span class="token plain"> Contributor </span><span class="token parameter variable" style="color:#36acaa">--scopes</span><span class="token plain"> /subscriptions/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">subscription_id</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider </span><span class="token string" style="color:#e3116c">"azurerm"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  features </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subscription_id   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"9e7c5e29-60c3-******-****-********"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id         </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b42795af-74d2-****-*****-****"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_id         </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"a887e74b-****-4ae5-84d6-********"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_secret     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"q5b8Q~D&amp;&amp;&amp;&amp;&amp;&amp;*****jec_k"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_certificate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster_ca_certificate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster_password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster_username </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCuQxKT5JhDZD+************/r11DJCx/SlwguHFucV3R+wQSF7/3WwZaqANUS/ArN+zUoAjqmST/UfaJ5JBg4aehoHmzzzhVn/cqA3V31V2rJog5siIYYFFan19VgxsqS3/QH9kxU0/QjQ3PqLOe0hPrbENpnJ8t1BgszokaTPToaJrCMIoCzgY7mBWVnseqgG6qU8vowMM**************tmFKD/tCylxBTecfAsbJBiJt5lcx8eF5dIS**************I7IhAyeHKicexZbt82Lxu6tXwJERYBQ5lkX4Kp************iMuJQ9QEChPCKveKlmU+Tlg3n1P0fNbCo+oWCdRuP6hm4HrU/+Z**********rCCU= generated-by-azure"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubernetes_cluster_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"cluster-diverse-bear"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource_group_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rg-premium-koala"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-terraform-설정-값">1-3. Terraform 설정 값<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-3-terraform-%EC%84%A4%EC%A0%95-%EA%B0%92" class="hash-link" aria-label="Direct link to 1-3. Terraform 설정 값" title="Direct link to 1-3. Terraform 설정 값">​</a></h2>
<ul>
<li><code>terraform-docs</code>로 생성함</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> terraform-docs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ terraform-docs markdown table </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --output-file README.md </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --output-mode inject </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">README.md updated successfully</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-1-readmemd-file-내용---terraform-docs-생성파일">1-3-1. README.md file 내용 - <code>terraform-docs</code> 생성파일<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-3-1-readmemd-file-%EB%82%B4%EC%9A%A9---terraform-docs-%EC%83%9D%EC%84%B1%ED%8C%8C%EC%9D%BC" class="hash-link" aria-label="Direct link to 1-3-1-readmemd-file-내용---terraform-docs-생성파일" title="Direct link to 1-3-1-readmemd-file-내용---terraform-docs-생성파일">​</a></h3>
<hr>
<blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h3>
<table><thead><tr><th>Name</th><th>Version</th></tr></thead><tbody><tr><td><a name="requirement_terraform"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#requirement_terraform">terraform</a></td><td>&gt;=1.0</td></tr><tr><td><a name="requirement_azapi"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#requirement_azapi">azapi</a></td><td>~&gt;1.5</td></tr><tr><td><a name="requirement_azurerm"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#requirement_azurerm">azurerm</a></td><td>~&gt;3.0</td></tr><tr><td><a name="requirement_random"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#requirement_random">random</a></td><td>~&gt;3.0</td></tr><tr><td><a name="requirement_time"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#requirement_time">time</a></td><td>0.9.1</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="providers">Providers<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#providers" class="hash-link" aria-label="Direct link to Providers" title="Direct link to Providers">​</a></h3>
<table><thead><tr><th>Name</th><th>Version</th></tr></thead><tbody><tr><td><a name="provider_azapi"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#provider_azapi">azapi</a></td><td>1.12.1</td></tr><tr><td><a name="provider_azurerm"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#provider_azurerm">azurerm</a></td><td>3.93.0</td></tr><tr><td><a name="provider_random"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#provider_random">random</a></td><td>3.6.0</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modules">Modules<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules">​</a></h3>
<p>No modules.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h3>
<table><thead><tr><th>Name</th><th>Type</th></tr></thead><tbody><tr><td>[azapi_resource.ssh_public_key](<a href="https://registry.terraform.io/providers/azure/azapi/latest/docs/resources/%3E" target="_blank" rel="noopener noreferrer">https://registry.terraform.io/providers/azure/azapi/latest/docs/resources/&gt;</a> resource)</td><td>resource</td></tr><tr><td>[azapi_resource_action.ssh_public_key_gen](<a href="https://registry.terraform.io/providers/azure/azapi/latest/docs/%3E" target="_blank" rel="noopener noreferrer">https://registry.terraform.io/providers/azure/azapi/latest/docs/&gt;</a> resources/resource_action)</td><td>resource</td></tr><tr><td>[azurerm_kubernetes_cluster.k8s](<a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/%3E" target="_blank" rel="noopener noreferrer">https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/&gt;</a> resources/kubernetes_cluster)</td><td>resource</td></tr><tr><td>[azurerm_resource_group.rg](<a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/%3E" target="_blank" rel="noopener noreferrer">https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/&gt;</a> resources/resource_group)</td><td>resource</td></tr><tr><td>[random_pet.azurerm_kubernetes_cluster_dns_prefix](<a href="https://registry.terraform.io/providers/hashicorp/%3E" target="_blank" rel="noopener noreferrer">https://registry.terraform.io/providers/hashicorp/&gt;</a> random/latest/docs/resources/pet)</td><td>resource</td></tr><tr><td>[random_pet.azurerm_kubernetes_cluster_name](<a href="https://registry.terraform.io/providers/hashicorp/random/%3E" target="_blank" rel="noopener noreferrer">https://registry.terraform.io/providers/hashicorp/random/&gt;</a> latest/docs/resources/pet)</td><td>resource</td></tr><tr><td><a href="https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/pet" target="_blank" rel="noopener noreferrer">random_pet.rg_name</a></td><td>&gt; resource</td></tr><tr><td>[random_pet.ssh_key_name](<a href="https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/%3E" target="_blank" rel="noopener noreferrer">https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/&gt;</a> pet)</td><td>resource</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="inputs">Inputs<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#inputs" class="hash-link" aria-label="Direct link to Inputs" title="Direct link to Inputs">​</a></h3>
<table><thead><tr><th>Name</th><th>Description</th><th>Type</th><th>Default</th><th style="text-align:center">Required</th></tr></thead><tbody><tr><td><a name="input_msi_id"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#input_msi_id">msi_id</a></td><td>The Managed Service Identity ID. Set this value &gt; if you're running this example using Managed Identity as the authentication method.</td><td><code>string</code></td><td><code>null</code></td><td style="text-align:center">&gt; no</td></tr><tr><td><a name="input_node_count"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#input_node_count">node_count</a></td><td>The initial quantity of nodes for the &gt; node pool.</td><td><code>number</code></td><td><code>2</code></td><td style="text-align:center">no</td></tr><tr><td><a name="input_resource_group_location"></a> [resource_group_location]&gt; (#input_resource_group_location)</td><td>Location of the resource group.</td><td><code>string</code></td><td><code>"koreacentral"</code></td><td style="text-align:center">no</td></tr><tr><td><a name="input_resource_group_name_prefix"></a> [resource_group_name_prefix]&gt; (#input_resource_group_name_prefix)</td><td>Prefix of the resource group name that's combined with a random ID &gt; so name is unique in your Azure subscription.</td><td><code>string</code></td><td><code>"rg"</code></td><td style="text-align:center">no</td></tr><tr><td><a name="input_username"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#input_username">username</a></td><td>The admin username for the new cluster.</td><td>&gt; <code>string</code></td><td><code>"azureadmin"</code></td><td style="text-align:center">no</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="outputs">Outputs<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#outputs" class="hash-link" aria-label="Direct link to Outputs" title="Direct link to Outputs">​</a></h3>
<table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a name="output_client_certificate"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_client_certificate">client_certificate</a></td><td>n/a</td></tr><tr><td><a name="output_client_key"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_client_key">client_key</a></td><td>n/a</td></tr><tr><td><a name="output_cluster_ca_certificate"></a> [cluster_ca_certificate]&gt; (#output_cluster_ca_certificate)</td><td>n/a</td></tr><tr><td><a name="output_cluster_password"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_cluster_password">cluster_password</a></td><td>n/a</td></tr><tr><td><a name="output_cluster_username"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_cluster_username">cluster_username</a></td><td>n/a</td></tr><tr><td><a name="output_host"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_host">host</a></td><td>n/a</td></tr><tr><td><a name="output_key_data"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_key_data">key_data</a></td><td>n/a</td></tr><tr><td><a name="output_kube_config"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_kube_config">kube_config</a></td><td>n/a</td></tr><tr><td><a name="output_kubernetes_cluster_name"></a> [kubernetes_cluster_name]&gt; (#output_kubernetes_cluster_name)</td><td>n/a</td></tr><tr><td><a name="output_resource_group_name"></a> <a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#output_resource_group_name">resource_group_name</a></td><td>n/a</td></tr></tbody></table>
</blockquote>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-2-0-variablestf-파일-내용-중-변경-사항">1-3-2. <code>0-variables.tf</code> 파일 내용 중 변경 사항<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-3-2-0-variablestf-%ED%8C%8C%EC%9D%BC-%EB%82%B4%EC%9A%A9-%EC%A4%91-%EB%B3%80%EA%B2%BD-%EC%82%AC%ED%95%AD" class="hash-link" aria-label="Direct link to 1-3-2-0-variablestf-파일-내용-중-변경-사항" title="Direct link to 1-3-2-0-variablestf-파일-내용-중-변경-사항">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">variable</span><span class="token keyword type variable" style="color:#36acaa"> "resource_group_location" </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">type</span><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">default</span><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"koreacentral"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">###### region 설정 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">description</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Location of the resource group."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">variable</span><span class="token keyword type variable" style="color:#36acaa"> "node_count" </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">type</span><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">description</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"The initial quantity of nodes for the node pool."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">default</span><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">###### cluster node 갯수 설정 : minimal 설정 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">variable</span><span class="token keyword type variable" style="color:#36acaa"> "username" </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">type</span><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">description</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"The admin username for the new cluster."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">default</span><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"azureadmin"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">###### username for cluster (default value 그대로 이용) ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-3-1_providerstf">1-3-3. <code>1_providers.tf</code><a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-3-3-1_providerstf" class="hash-link" aria-label="Direct link to 1-3-3-1_providerstf" title="Direct link to 1-3-3-1_providerstf">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">terraform</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">required_version</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"&gt;=1.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">required_providers</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">azapi</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">source</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"azure/azapi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">version</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"~&gt;1.5"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">azurerm</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">source</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hashicorp/azurerm"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">version</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"~&gt;3.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">random</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">ㄹ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">source</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hashicorp/random"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">version</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"~&gt;3.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">time</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">source</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hashicorp/time"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">version</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.9.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">provider</span><span class="token keyword type variable" style="color:#36acaa"> "azurerm" </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">features</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">subscription_id</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"9e7c5e29-60c3-******-****-********"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">###### 설정에 맞게 변경함 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">tenant_id</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b42795af-74d2-****-*****-****"</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">###### 설정에 맞게 변경함 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">client_id</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"a887e74b-****-4ae5-84d6-********"</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">###### 설정에 맞게 변경함 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">client_secret</span><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"q5b8Q~D&amp;&amp;&amp;&amp;&amp;&amp;*****jec_k"</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">###### 설정에 맞게 변경함 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-4-2_sshtf--변경사항-없음">1-3-4. <code>2_ssh.tf</code> : 변경사항 없음<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-3-4-2_sshtf--%EB%B3%80%EA%B2%BD%EC%82%AC%ED%95%AD-%EC%97%86%EC%9D%8C" class="hash-link" aria-label="Direct link to 1-3-4-2_sshtf--변경사항-없음" title="Direct link to 1-3-4-2_sshtf--변경사항-없음">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-5-3_maintf">1-3-5. <code>3_main.tf</code><a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-3-5-3_maintf" class="hash-link" aria-label="Direct link to 1-3-5-3_maintf" title="Direct link to 1-3-5-3_maintf">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">....(생략)....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">default_node_pool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">name</span><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"agentpool"</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">###### pool 이름 설정 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">vm_size</span><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Standard_D2_v2"</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">###### vm size 설정 ######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">node_count</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> var.node_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">....(생략)....</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-6-7_outputtf--변경-없음">1-3-6. <code>7_output.tf</code> : 변경 없음<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#1-3-6-7_outputtf--%EB%B3%80%EA%B2%BD-%EC%97%86%EC%9D%8C" class="hash-link" aria-label="Direct link to 1-3-6-7_outputtf--변경-없음" title="Direct link to 1-3-6-7_outputtf--변경-없음">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-terraform-실생">2. Terraform 실생<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#2-terraform-%EC%8B%A4%EC%83%9D" class="hash-link" aria-label="Direct link to 2. Terraform 실생" title="Direct link to 2. Terraform 실생">​</a></h2>
<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ terraform init </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ terraform plan </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ terraform apply </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-참고-사이트">7. [참고 사이트]<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#7-%EC%B0%B8%EA%B3%A0-%EC%82%AC%EC%9D%B4%ED%8A%B8" class="hash-link" aria-label="Direct link to 7. [참고 사이트]" title="Direct link to 7. [참고 사이트]">​</a></h2>
<ul>
<li><del>기억이 안남</del></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-epilog">8. Epilog<a href="https://hansgun.github.io/2024/10/26/sixth-terrform-aks#8-epilog" class="hash-link" aria-label="Direct link to 8. Epilog" title="Direct link to 8. Epilog">​</a></h2>
<ul>
<li>idempotent IaC 을 통해서 infra provisioning 관리를 해보고자 했는데, 실제 업무 환경에서는 보안적 문제와 반복 업무의 부재 등으로 도입 되지 않았다. side-project로 밖에 경험할 수 없을 것 같다.</li>
<li>예전 Hadoop 설치의 복잡함을 해결하고자 ansible로 IaC 구성한 적이 있는데, 자료를 남기지 않았었고, 이전 회사의 경험이라 자료가 없어 기록으로 남기지 못해 아쉽다.</li>
</ul>
<hr>]]></content:encoded>
            <category>Redis Cluster</category>
            <category>kubernetes</category>
        </item>
        <item>
            <title><![CDATA[Authorizer Architecuture]]></title>
            <link>https://hansgun.github.io/2020/01/29/second-blog</link>
            <guid>https://hansgun.github.io/2020/01/29/second-blog</guid>
            <pubDate>Tue, 28 Jan 2020 06:38:01 GMT</pubDate>
            <description><![CDATA[summary]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>summary</p>
</blockquote>
<blockquote>
<p><em>project 구현 기반. single server에 single proxy, 2-java Oauth container를 연결한 형태임</em></p>
</blockquote>
<ul>
<li>외부 통신은 단일 interface를 통하여 수행. (nginX reverse proxy 이용, port 8078[현재버전])</li>
<li>실제 authorizer component는 이중화 구성하며, 외부에 노출되는 port는 없음</li>
<li>위 2가지 component는 health check fail 시 자동으로 재기동. (현재는 proxy만 설정된 상태 ==&gt; restart<!-- -->:always<!-- -->)</li>
<li>cache layer는 redis 를 활용한다.</li>
</ul>
<h1>2. 구축 방안</h1>
<ul>
<li>개별 component는 docker container를 이용.</li>
<li>하나의 서비스화를 위하여 docker-compose로 구성</li>
<li>현 버전은 하나의 물리 서버에서 docker container를 여러 개 띄우는 구성이며, 물리 서버의 cluster화 할 경우 추가 solution 필요</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-1-implementation">2-1. implementation<a href="https://hansgun.github.io/2020/01/29/second-blog#2-1-implementation" class="hash-link" aria-label="Direct link to 2-1. implementation" title="Direct link to 2-1. implementation">​</a></h2>
<ul>
<li>$HOME directory 관련 파일 구조</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">├── Dockerfile ## authorizer 생성 Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Dockerfile_proxy ## proxy(nginx) 생성 Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── docker-compose.yml ## docker-compose file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── make_docker_compose.sh ## 전체 프로세스를 수행하기 위한 shell script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── nginx.conf ## Dockerfile_proxy 에서 사용할 nginx config 파일</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .env ## docker-compose 환경 변수</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── target ## authorizer jar 파일이 생성되는 위치</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>설치 방법</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sh make_docker_compose.sh &lt;설치된 물리서버 IP address&gt; ## IP address는 .env에서 redis에서 활용</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-2-각-파일의-내용">2-2. 각 파일의 내용<a href="https://hansgun.github.io/2020/01/29/second-blog#2-2-%EA%B0%81-%ED%8C%8C%EC%9D%BC%EC%9D%98-%EB%82%B4%EC%9A%A9" class="hash-link" aria-label="Direct link to 2-2. 각 파일의 내용" title="Direct link to 2-2. 각 파일의 내용">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-2-1-shell-script">2-2-1. shell script<a href="https://hansgun.github.io/2020/01/29/second-blog#2-2-1-shell-script" class="hash-link" aria-label="Direct link to 2-2-1. shell script" title="Direct link to 2-2-1. shell script">​</a></h3>
<p><code>make_docker_compose.sh</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## check parameter length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$#</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-gt</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$#</span><span class="token string" style="color:#e3116c"> is Illegal number of parameters."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Usage: </span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c"> [authoizer1_host_ip] [authorizer2_host_ip]"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">args</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## print parameter list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa"> c</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">0</span><span class="token variable punctuation" style="color:#393A34">;</span><span class="token variable" style="color:#36acaa"> c</span><span class="token variable operator" style="color:#393A34">&lt;</span><span class="token variable" style="color:#36acaa">$#</span><span class="token variable punctuation" style="color:#393A34">;</span><span class="token variable" style="color:#36acaa"> c</span><span class="token variable operator" style="color:#393A34">++</span><span class="token variable" style="color:#36acaa">   </span><span class="token variable punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$c</span><span class="token string" style="color:#e3116c"> th parameter = </span><span class="token string variable" style="color:#36acaa">${args</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable" style="color:#36acaa">$c</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## set-up .env file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"APP_HOST_NAME=auth_app"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$#</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-eq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"APP_HOST_IP1=</span><span class="token string variable" style="color:#36acaa">${args</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable" style="color:#36acaa">0</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"APP_HOST_IP2=</span><span class="token string variable" style="color:#36acaa">${args</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable" style="color:#36acaa">1</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$#</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-eq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"APP_HOST_IP1=</span><span class="token string variable" style="color:#36acaa">${args</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable" style="color:#36acaa">0</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"APP_HOST_IP2=</span><span class="token string variable" style="color:#36acaa">${args</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable" style="color:#36acaa">0</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"APP_HOST_IP1=127.0.0.1"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"APP_HOST_IP2=127.0.0.1"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## build jar file for authorizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-DskipTests</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true clean </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## docker-compose up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> up </span><span class="token parameter variable" style="color:#36acaa">--build</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-2-2-docker-compose-관련-파일">2-2-2. docker-compose 관련 파일<a href="https://hansgun.github.io/2020/01/29/second-blog#2-2-2-docker-compose-%EA%B4%80%EB%A0%A8-%ED%8C%8C%EC%9D%BC" class="hash-link" aria-label="Direct link to 2-2-2. docker-compose 관련 파일" title="Direct link to 2-2-2. docker-compose 관련 파일">​</a></h3>
<ul>
<li>docker-compose.yml : service 전체 내용 및 dependency 실행 순서 등 container 제어</li>
<li>.env : docker-compose.yml 에서 사용할 환경 변수 정의</li>
<li>Dockerfile : authorizer(springboot OAuth2 server) container image</li>
<li>Dockerfile_proxy : nginx 설치 이미지로 다음 절(2-2-3에서 설명)</li>
</ul>
<p><code>docker-compose.yml</code></p>
<ul>
<li>순서대로 redis, authorizer1, authorizer2, proxy 4개의 이미지를 생성</li>
<li>proxy service 구성 중 links 부분은 명명된 service를 ip가 아닌 name으로 접근 가능하도록 설정함</li>
</ul>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># VERSION 1.0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># AUTHOR: project</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># DESCRIPTION: project Authorizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># BUILD: docker-compose -p &lt;name&gt; -d up -build</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># SOURCE: https://github.com/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'2.1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  redis:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    image: redis:3.2.12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      - "6379:6379"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authorizer1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#hostname: authorizer1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#container_name: authorizer1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REDIS_HOST=redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_IP1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">## .env 에 정의된 변수 사용</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#ports: ## port expose test.. authorizer container 외부로 open 되는 port 없음</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#  - "8085:8081"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    depends_on:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      - redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authorizer2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REDIS_HOST=redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_IP2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#  - "8086:8081"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    depends_on:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      - redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">proxy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dockerfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dockerfile_proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      - "8084:80" ## nginX 80 port를 외부 8084 port로 expose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> authorizer1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> authorizer2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">links</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">## docker 내부 네트워크에서 접근하기 위하여 hostname 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> authorizer1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">authorizer1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> authorizer2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">authorizer2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#extra_hosts:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#  - "authorizer1:${APP_HOST_IP1}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#  - "authorizer2:${APP_HOST_IP2}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"curl --fail http://localhost:8084/ || exit 1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-2-3-nginx-관련">2-2-3. NginX 관련<a href="https://hansgun.github.io/2020/01/29/second-blog#2-2-3-nginx-%EA%B4%80%EB%A0%A8" class="hash-link" aria-label="Direct link to 2-2-3. NginX 관련" title="Direct link to 2-2-3. NginX 관련">​</a></h3>
<ul>
<li>Dockerfile_proxy : nginx image를 생성하는 dockerfile</li>
<li>nginx.conf : nginx 에서 사용할 config 를 미리 정의한 내용</li>
</ul>
<p><code>Dockerfile_proxy</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># VERSION v.1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AUTHOR: hansgun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># DESCRIPTION: project authorizer proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># BUILD: docker build --rm -t project/proxy .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SOURCE: https://github.com/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM nginx:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./nginx.conf /etc/nginx/ ## current directory 에서 conf 파일 복사</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>nginx.conf</code></p>
<ul>
<li>** 특이점은 nginx 에서 authorizer1,2 docker 접근 시 IP가 아닌 hostname으로 접근하여, container 내부의 port를 직접 접근 함</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># /etc/nginx/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user  nginx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_processes  1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_log  /var/log/nginx/error.log warn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid        /var/run/nginx.pid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker_connections  1024;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include mime.types;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    upstream myapp1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        least_conn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server authorizer1:8081 max_fails=1 fail_timeout=2s; # authorizer1,2 에 대한 load balancing 설정</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server authorizer2:8081 max_fails=1 fail_timeout=2s; # docker네트워크에서 hostname으로 접근. IP, port 불필요</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen 8078;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        access_log /var/log/nginx/tomcat_access.log;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location /spring-security-oauth-server { ## authorizer application.yml 의 spring.servlet.context-path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_pass http://myapp1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                proxy_set_header X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                proxy_set_header Host $host:$server_port;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                proxy_redirect off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-실행결과">3. 실행결과<a href="https://hansgun.github.io/2020/01/29/second-blog#3-%EC%8B%A4%ED%96%89%EA%B2%B0%EA%B3%BC" class="hash-link" aria-label="Direct link to 3. 실행결과" title="Direct link to 3. 실행결과">​</a></h2>
<p><code>sh make_docker_compose.sh 192.168.1.168 &lt;-- IP는 환경에 맞게 변경 필요</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0 th parameter = 192.168.1.168</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Error stacktraces are turned on.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Scanning for projects...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] -------------&lt; kr.co.project.feedernet:projectAuthorizer &gt;--------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Building projectAuthorizer 1.0.0-SNAPSHOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] --------------------------------[ jar ]---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... 중간 생략 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] BUILD SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Total time:  5.199 s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Finished at: 2020-01-03T09:43:27+09:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building authorizer1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 1/12 : FROM java:8-jre</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; e44d62cf8862</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 2/12 : ENV APP_HOME /usr/lib/authorizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 4da19107a7c2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 3/12 : RUN echo "Asia/Seoul" &gt; /etc/timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; d6d7ac7e2220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 4/12 : RUN dpkg-reconfigure -f noninteractive tzdata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 3b9bc1f0b6aa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 5/12 : RUN useradd -ms /bin/bash -d ${APP_HOME} authorizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 2bad24c3166b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 6/12 : ARG JAR_FILE="target/*.jar"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 5f886986b5a2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 7/12 : COPY ${JAR_FILE} ${APP_HOME}/authorizer.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 76556a94980a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 8/12 : RUN chown authorizer: -R ${APP_HOME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Running in 6f4cc39bc255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing intermediate container 6f4cc39bc255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; a16310494008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 9/12 : EXPOSE 8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Running in 74d861e17a9f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing intermediate container 74d861e17a9f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; f0a15efc2613</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 10/12 : USER authorizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Running in f9b2f072847a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing intermediate container f9b2f072847a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 13821a47ae94</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 11/12 : WORKDIR ${APP_HOME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Running in 6a1cc49da232</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing intermediate container 6a1cc49da232</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 8f3abf8226fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 12/12 : ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-Xms256m","-Xmx512m","-server","-XX:+UseNUMA","-XX:+UseParallelGC","-XX:+AggressiveOpts","-XX:+UseFastAccessorMethods","-jar","authorizer.jar"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Running in ce9aa6573758</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing intermediate container ce9aa6573758</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 759031b1bfd8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully built 759031b1bfd8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully tagged projectauthorizer_authorizer1:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building authorizer2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 1/12 : FROM java:8-jre</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; e44d62cf8862</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 2/12 : ENV APP_HOME /usr/lib/authorizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 4da19107a7c2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 3/12 : RUN echo "Asia/Seoul" &gt; /etc/timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; d6d7ac7e2220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 4/12 : RUN dpkg-reconfigure -f noninteractive tzdata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 3b9bc1f0b6aa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 5/12 : RUN useradd -ms /bin/bash -d ${APP_HOME} authorizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 2bad24c3166b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 6/12 : ARG JAR_FILE="target/*.jar"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 5f886986b5a2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 7/12 : COPY ${JAR_FILE} ${APP_HOME}/authorizer.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 76556a94980a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 8/12 : RUN chown authorizer: -R ${APP_HOME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; a16310494008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 9/12 : EXPOSE 8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; f0a15efc2613</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 10/12 : USER authorizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 13821a47ae94</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 11/12 : WORKDIR ${APP_HOME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 8f3abf8226fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 12/12 : ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-Xms256m","-Xmx512m","-server","-XX:+UseNUMA","-XX:+UseParallelGC","-XX:+AggressiveOpts","-XX:+UseFastAccessorMethods","-jar","authorizer.jar"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 759031b1bfd8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully built 759031b1bfd8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully tagged projectauthorizer_authorizer2:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 1/2 : FROM nginx:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; f949e7d76d63</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 2/2 : COPY ./nginx.conf /etc/nginx/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Using cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; de0942485c9f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully built de0942485c9f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully tagged projectauthorizer_proxy:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recreating projectauthorizer_redis_1 ... done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recreating projectauthorizer_authorizer2_1 ... done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recreating projectauthorizer_authorizer1_1 ... done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recreating projectauthorizer_proxy_1       ... done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>docker-compose ps</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">             Name                            Command                       State                   Ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">projectauthorizer_authorizer1_1   java -Djava.security.egd=f ...   Up                      8081/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">projectauthorizer_authorizer2_1   java -Djava.security.egd=f ...   Up                      8081/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">projectauthorizer_proxy_1         nginx -g daemon off;             Up (health: starting)   0.0.0.0:8084-&gt;8078/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">projectauthorizer_redis_1         docker-entrypoint.sh redis ...   Up                      0.0.0.0:6379-&gt;6379/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>docker network inspect projectauthorizer_default</code></p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"projectauthorizer_default"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Id"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ab7956cbd8e787be575c050acd842854ed18906bf89c9566b929b818a90fe006"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Created"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2020-01-02T08:28:09.400768103Z"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"local"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Driver"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"bridge"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"EnableIPv6"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"IPAM"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"Driver"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"default"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"Options"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"Config"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string-property property" style="color:#36acaa">"Subnet"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.29.0.0/16"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string-property property" style="color:#36acaa">"Gateway"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.29.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Internal"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Attachable"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Ingress"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"ConfigFrom"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"Network"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"ConfigOnly"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Containers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"13dba477f3abd8b6d346b956a2787561a7affc29eca268234d463231db0e4d16"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"Name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"projectauthorizer_proxy_1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"EndpointID"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"16cd689ed587cb92b19813337a3944cccf7d5685c080ddbc6c25f1a7fbe93b91"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"MacAddress"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"02:42:ac:1d:00:05"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv4Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.29.0.5/16"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv6Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"591a74c933dd05b9dccb29b2b56dd58dc5d42e1f1e6a0c3fdb54e7b384f103b2"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"Name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"projectauthorizer_authorizer1_1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"EndpointID"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"13633a2221edf6874fecb11b1a7dea0c0ddbdf5ac80cacb27c59ffd06225784c"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"MacAddress"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"02:42:ac:1d:00:03"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv4Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.29.0.3/16"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv6Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"6702531cb6602b36086c570dd12f830ba76a7279426d7a523056b77b902d17b4"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"Name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"projectauthorizer_redis_1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"EndpointID"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2fcaa3885607fdee1f46ea95f97ec534f71d38945fc347663a78c599bfdd7146"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"MacAddress"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"02:42:ac:1d:00:02"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv4Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.29.0.2/16"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv6Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"a42280ac856a5778395a34dab634e3e511ff1fd45b98cd68e0946640193d3bd6"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"Name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"projectauthorizer_authorizer2_1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"EndpointID"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"a9c34a66279c465706351d252745055037d5f0c819670e9a7fd10de3b0709179"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"MacAddress"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"02:42:ac:1d:00:04"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv4Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.29.0.4/16"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">"IPv6Address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Options"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Labels"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"com.docker.compose.network"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"default"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"com.docker.compose.project"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"projectauthorizer"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"com.docker.compose.version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.24.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-접근-테스트">4. 접근 테스트<a href="https://hansgun.github.io/2020/01/29/second-blog#4-%EC%A0%91%EA%B7%BC-%ED%85%8C%EC%8A%A4%ED%8A%B8" class="hash-link" aria-label="Direct link to 4. 접근 테스트" title="Direct link to 4. 접근 테스트">​</a></h2>
<p><code>http://&lt;서버 IP&gt;:8078/spring-security-oauth-server/</code></p>]]></content:encoded>
            <category>docker-compose</category>
            <category>authorizer</category>
        </item>
        <item>
            <title><![CDATA[Setup CI/CD [Jenkins+Nexus for Spring, Docker, R]]]></title>
            <link>https://hansgun.github.io/2019/11/17/first-blog</link>
            <guid>https://hansgun.github.io/2019/11/17/first-blog</guid>
            <pubDate>Sun, 17 Nov 2019 16:16:01 GMT</pubDate>
            <description><![CDATA[summary]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>summary</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="0-구성요소">0. 구성요소<a href="https://hansgun.github.io/2019/11/17/first-blog#0-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C" class="hash-link" aria-label="Direct link to 0. 구성요소" title="Direct link to 0. 구성요소">​</a></h2>
<ul>
<li>jenkins</li>
<li>nexus OSS</li>
<li>ansible</li>
<li>docker</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-jenkins-설치">1. Jenkins 설치<a href="https://hansgun.github.io/2019/11/17/first-blog#1-jenkins-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 1. Jenkins 설치" title="Direct link to 1. Jenkins 설치">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-1-다운로드-및-실행">1-1. 다운로드 및 실행<a href="https://hansgun.github.io/2019/11/17/first-blog#1-1-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-%EB%B0%8F-%EC%8B%A4%ED%96%89" class="hash-link" aria-label="Direct link to 1-1. 다운로드 및 실행" title="Direct link to 1-1. 다운로드 및 실행">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://mirrors.jenkins.io/war-stable/latest/jenkins.war</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#java -jar jenkins.war --httpPort=8080 --prefix=/jenkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-2-접속">1-2. 접속<a href="https://hansgun.github.io/2019/11/17/first-blog#1-2-%EC%A0%91%EC%86%8D" class="hash-link" aria-label="Direct link to 1-2. 접속" title="Direct link to 1-2. 접속">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://&lt;hostname&gt;:8080/jenkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3-slave-설정">1-3. slave 설정<a href="https://hansgun.github.io/2019/11/17/first-blog#1-3-slave-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 1-3. slave 설정" title="Direct link to 1-3. slave 설정">​</a></h3>
<blockquote>
<p><code>UI 에서 Jenkins 관리 &gt; 노드관리 로 옮긴후 신규노드 를 열어봅니다:</code><br>
<code>1. 노드명을 입력: 예를들어 slave-01</code><br>
<code>2. Permanent Agent 를 선택</code><br>
<code>설정 Page 에서:</code><br>
<code>1. Remote root directory 에 입력, 예를들어, /opt/jenkins.</code><br>
<code>2. Launch method 는 Launch Slave Agents via SSH 를 선택, host 명 입력후 credential 추가</code><br>
<code>2.1 Credential 추가시 Slave node user, jenkins 와 그 password 를 등록함</code><br>
<code>2.2 혹은 SSH Username with private key 선택, From the jenkins master ~/.ssh  선택</code><br>
<code>2.2.1 master 에서</code></p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">su</span><span class="token plain"> - jenkins</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># generate key.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> rsa</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># copy master public key to slave.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> ~/.ssh/id_rsa.pub </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hostname</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 혹은 cat ~/.ssh/id_pub.rsa &gt; authorized_keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># add config to ~/.ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> ~/.ssh/config</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StrictHostKeyChecking no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># chmod.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> ~/.ssh/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># check connection to slave.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> emb-a01</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-nexus-설치">2. nexus 설치<a href="https://hansgun.github.io/2019/11/17/first-blog#2-nexus-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 2. nexus 설치" title="Direct link to 2. nexus 설치">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># download.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># https://www.sonatype.com/download-oss-sonatype</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># change data directory.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># https://help.sonatype.com/repomanager3/installation/configuring-the-runtime-environment#ConfiguringtheRuntimeEnvironment-ConfiguringtheDataDirectory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nexus-home</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/bin</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> nexus.vmoptions</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Xms2703m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Xmx2703m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-XX:MaxDirectMemorySize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">2703m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-XX:+UnlockDiagnosticVMOptions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-XX:+UnsyncloadClass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-XX:+LogVMOutput</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-XX:LogFile</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/sonatype-work/nexus3/log/jvm.log </span><span class="token comment" style="color:#999988;font-style:italic">## 변경</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-XX:-OmitStackTraceInFastThrow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Djava.net.preferIPv4Stack</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Dkaraf.home</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Dkaraf.base</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Dkaraf.etc</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">etc/karaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Djava.util.logging.config.file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">etc/karaf/java.util.logging.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Dkaraf.data</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/sonatype-work/nexus3 </span><span class="token comment" style="color:#999988;font-style:italic">## 변경</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Djava.io.tmpdir</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/sonatype-work/nexus3/tmp </span><span class="token comment" style="color:#999988;font-style:italic">## 변경</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-Dkaraf.startLocalConsole</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-nexus-docker-registry-설정">3. nexus docker registry 설정<a href="https://hansgun.github.io/2019/11/17/first-blog#3-nexus-docker-registry-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 3. nexus docker registry 설정" title="Direct link to 3. nexus docker registry 설정">​</a></h2>
<blockquote>
<p>Reference: <a href="https://www.ivankrizsan.se/2016/06/09/create-a-private-docker-registry/" target="_blank" rel="noopener noreferrer">config reference</a></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-nexus-설정용-pom-file">4. nexus 설정용 pom file<a href="https://hansgun.github.io/2019/11/17/first-blog#4-nexus-%EC%84%A4%EC%A0%95%EC%9A%A9-pom-file" class="hash-link" aria-label="Direct link to 4. nexus 설정용 pom file" title="Direct link to 4. nexus 설정용 pom file">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-1-pomxml">4-1. pom.xml<a href="https://hansgun.github.io/2019/11/17/first-blog#4-1-pomxml" class="hash-link" aria-label="Direct link to 4-1. pom.xml" title="Direct link to 4-1. pom.xml">​</a></h3>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">repositories</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">repository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">central</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://localhost:8081/repository/maven-public/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">snapshots</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">enabled</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">enabled</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">updatePolicy</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">always</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">updatePolicy</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">snapshots</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">repository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">repositories</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">pluginRepositories</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">pluginRepository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">central</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://localhost:8081/repository/maven-public/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">releases</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">enabled</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">enabled</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">releases</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">snapshots</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">enabled</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">enabled</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">snapshots</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">pluginRepository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">pluginRepositories</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">distributionManagement</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">snapshotRepository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">snap</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://localhost:8081/repository/maven-snapshots/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">snapshotRepository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">repository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rel</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://localhost:8081/repository/maven-releases/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">repository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">distributionManagement</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-2-mvn-setting">4-2. mvn setting..<a href="https://hansgun.github.io/2019/11/17/first-blog#4-2-mvn-setting" class="hash-link" aria-label="Direct link to 4-2. mvn setting.." title="Direct link to 4-2. mvn setting..">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># mvn -version 으로 maven_home 확인 후</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$MAVEN_HOME</span><span class="token plain">.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> settings.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">servers</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">server</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">central</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">username</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">$(nexus_username)</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">username</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">$(nexus_passwd)</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">server</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">server</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">snap</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">username</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">$(nexus_username)</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">username</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">$(nexus_passwd)</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">server</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">server</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rel</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">username</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">$(nexus_username)</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">username</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">$(nexus_passwd)</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">server</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">servers</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-3-deploy-test">4-3. Deploy test<a href="https://hansgun.github.io/2019/11/17/first-blog#4-3-deploy-test" class="hash-link" aria-label="Direct link to 4-3. Deploy test" title="Direct link to 4-3. Deploy test">​</a></h3>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn -e -DskipTests=true clean install deploy;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-배포-대상-서버-설정">5. 배포 대상 서버 설정<a href="https://hansgun.github.io/2019/11/17/first-blog#5-%EB%B0%B0%ED%8F%AC-%EB%8C%80%EC%83%81-%EC%84%9C%EB%B2%84-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 5. 배포 대상 서버 설정" title="Direct link to 5. 배포 대상 서버 설정">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-1-docker-private-registry-등록">5-1. docker private registry 등록<a href="https://hansgun.github.io/2019/11/17/first-blog#5-1-docker-private-registry-%EB%93%B1%EB%A1%9D" class="hash-link" aria-label="Direct link to 5-1. docker private registry 등록" title="Direct link to 5-1. docker private registry 등록">​</a></h3>
<div class="language-ksh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ksh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># /etc/docker/daemon.json 파일 편집하여 secure 예외 처리 등록</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "insecure-registries": ["&lt;ip&gt;:&lt;port&gt;","&lt;domain&gt;:&lt;port&gt;"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 저장후 docker restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># wheel group user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl stop docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;userID&gt; 계정(group id : docker) 에서 정보 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># docker info의 마지막 섹션 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">....(생략)....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Insecure Registries:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;ip or domain&gt;:&lt;port&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   127.0.0.0/8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Live Restore Enabled: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-2-private-registry-login">5-2. private registry login<a href="https://hansgun.github.io/2019/11/17/first-blog#5-2-private-registry-login" class="hash-link" aria-label="Direct link to 5-2. private registry login" title="Direct link to 5-2. private registry login">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># private docker registry login</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># docker login -u&lt;userid&gt; -p&lt;password&gt; &lt;ip or domain&gt;:&lt;port&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> login </span><span class="token parameter variable" style="color:#36acaa">-uadmin</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ip or domain</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-3-image-pull--확인">5-3. image pull &amp; 확인<a href="https://hansgun.github.io/2019/11/17/first-blog#5-3-image-pull--%ED%99%95%EC%9D%B8" class="hash-link" aria-label="Direct link to 5-3. image pull &amp; 확인" title="Direct link to 5-3. image pull &amp; 확인">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># docker image pull</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ip or domain</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/app:1.0.0-SNAPSHOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># image 확인</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> images </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ip or domain</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/app   </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">.0-SNAPSHOT      ec62cef80ecf        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> hours ago         235MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-nexus-r-plugin-설정">6. Nexus R-plugin 설정<a href="https://hansgun.github.io/2019/11/17/first-blog#6-nexus-r-plugin-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 6. Nexus R-plugin 설정" title="Direct link to 6. Nexus R-plugin 설정">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-1-plugin-다운로드">6-1. plugin 다운로드<a href="https://hansgun.github.io/2019/11/17/first-blog#6-1-plugin-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C" class="hash-link" aria-label="Direct link to 6-1. plugin 다운로드" title="Direct link to 6-1. plugin 다운로드">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">requirements<a href="https://hansgun.github.io/2019/11/17/first-blog#requirements" class="hash-link" aria-label="Direct link to requirements" title="Direct link to requirements">​</a></h4>
<ul>
<li>Apache Maven 3.3.3+</li>
<li>OpenJDK 8</li>
<li>Network access to <a href="https://repository.sonatype.org/content/groups/sonatype-public-grid" target="_blank" rel="noopener noreferrer">https://repository.sonatype.org/content/groups/sonatype-public-grid</a></li>
<li>nexus version과 호환되는 plugin 을 다운 받는다</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="nexusr-plugin-version">nexus,R plugin version<a href="https://hansgun.github.io/2019/11/17/first-blog#nexusr-plugin-version" class="hash-link" aria-label="Direct link to nexus,R plugin version" title="Direct link to nexus,R plugin version">​</a></h4>
<table><thead><tr><th>Plugin Version</th><th>Nexus Repository Version</th></tr></thead><tbody><tr><td>v1.0.0</td><td>&lt;3.8.0-02</td></tr><tr><td>v1.0.1</td><td>&gt;=3.8.0-02</td></tr><tr><td>v1.0.2</td><td>&gt;=3.14.0-04</td></tr><tr><td>v1.0.3</td><td>&gt;=3.15.2-01</td></tr><tr><td>v1.0.4</td><td>&gt;=3.18.0-01</td></tr></tbody></table>
<p>plugin <a href="https://github.com/sonatype-nexus-community/nexus-repository-r/releases" target="_blank" rel="noopener noreferrer">Download link</a></p>
<ul>
<li>nexus-repository-r-1.0.4.jar 기준으로 아래에 설명</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-2-r-plugin-설치">6-2. R-plugin 설치<a href="https://hansgun.github.io/2019/11/17/first-blog#6-2-r-plugin-%EC%84%A4%EC%B9%98" class="hash-link" aria-label="Direct link to 6-2. R-plugin 설치" title="Direct link to 6-2. R-plugin 설치">​</a></h3>
<p>1.) 아래의 3개의 파일 복사와 설정 추가 필요함</p>
<ul>
<li><code>&lt;nexus_dir&gt;/system/org/sonatype/nexus/plugins/nexus-repository-r/1.0.4/nexus-repository-r-1.0.4.jar</code></li>
<li><code>&lt;nexus_dir&gt;/system/com/sonatype/nexus/assemblies/nexus-oss-feature/3.x.y/nexus-oss-feature-3.x.y-features.xml</code></li>
<li><code>&lt;nexus_dir&gt;/system/com/sonatype/nexus/assemblies/nexus-pro-feature/3.x.y/nexus-pro-feature-3.x.y-features.xml</code></li>
</ul>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">version</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">3.x.y.xy</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">prerequisite</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">false</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">dependency</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">false</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">nexus-repository-rubygems</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">version</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1.0.4</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">prerequisite</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">false</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">dependency</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">false</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">nexus-repository-r</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">version</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">3.x.y.xy</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">prerequisite</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">false</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">dependency</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">false</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">nexus-repository-yum</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>그리고,</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+ </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">nexus-repository-r</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">description</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">org.sonatype.nexus.plugins:nexus-repository-r</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">version</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1.0.3</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">details</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.sonatype.nexus.plugins:nexus-repository-r</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">details</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">bundle</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mvn:org.sonatype.nexus.plugins/nexus-repository-r/1.0.4</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">bundle</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">features</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-3-nexus-repository-추가">6-3. nexus repository 추가<a href="https://hansgun.github.io/2019/11/17/first-blog#6-3-nexus-repository-%EC%B6%94%EA%B0%80" class="hash-link" aria-label="Direct link to 6-3. nexus repository 추가" title="Direct link to 6-3. nexus repository 추가">​</a></h3>
<ul>
<li>정상적으로 설치되면 nexus의 create repository 메뉴에 r(proxy), r(hosted), r(group) 메뉴가 표시됨</li>
<li>r(proxy),r(hosted) repository를 추가 후 r(group)으로 묶어서 repository 생성.
자세한 내용은 링크 참조
<a href="https://github.com/sonatype-nexus-community/nexus-repository-r/blob/master/docs/R_USER_DOCUMENTATION.md" target="_blank" rel="noopener noreferrer">nexus R repository 만들기</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-4-로컬-r-설정">6-4. 로컬 R 설정<a href="https://hansgun.github.io/2019/11/17/first-blog#6-4-%EB%A1%9C%EC%BB%AC-r-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 6-4. 로컬 R 설정" title="Direct link to 6-4. 로컬 R 설정">​</a></h3>
<ul>
<li>R-cran을 proxy 를 거쳐가도록 repo list 설정이 필요</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># OS 별 위치 상이 R home 명령어로 확인</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#‘/Library/Frameworks/R.framework/Resources/etc/’ on OS X,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#‘C:Program FilesRR-***etc’ on Windows,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#‘/etc/R/’ on Debian.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> R.home</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"home"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 1st config. filename Rprofile.site</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> path.expand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"~"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 2nd config. filename .Rprofile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># edit $HOME/etc/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Default repo &lt;— Rprofile.site</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">r </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">- getOption</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"repos"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       r</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"Nexus"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">- </span><span class="token string" style="color:#e3116c">"http://&lt;nexusID&gt;:&lt;nexusPW&gt;@&lt;nexus r(group repository) address&gt;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       options</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">repos</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>R 신규 세션 연결 후 확인</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">R&gt; getOption('repos')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    Nexus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"http://&lt;nexusID&gt;:&lt;nexusPW&gt;@&lt;nexus r(group repository) address&gt;"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-5-r-package-download-test">6-5. R package download test<a href="https://hansgun.github.io/2019/11/17/first-blog#6-5-r-package-download-test" class="hash-link" aria-label="Direct link to 6-5. R package download test" title="Direct link to 6-5. R package download test">​</a></h3>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; remove.packages('dplyr')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing package from ‘/Library/Frameworks/R.framework/Versions/3.5/Resources/library’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(as ‘lib’ is unspecified)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error in remove.packages : there is no package called ‘dplyr’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; library(dplyr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error in library(dplyr) : there is no package called ‘dplyr’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; getOption('repos')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    Nexus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"http://&lt;nexusID&gt;:&lt;nexusPW&gt;@&lt;nexus r(group repository) address&gt;"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; install.packages('dplyr')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trying URL 'http://&lt;nexusID&gt;:&lt;nexusPW&gt;@&lt;nexus r(group repository) address&gt;/bin/macosx/el-capitan/contrib/3.5/dplyr_0.8.3.tgz'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content type 'application/x-tgz' length 6265040 bytes (6.0 MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">downloaded 6.0 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The downloaded binary packages are in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/var/folders/98/5jh6pvh54_n1xqk_y7c66t580000gn/T//Rtmpxy9PGN/downloaded_packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; library(dplyr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Attaching package: ‘dplyr’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The following objects are masked from ‘package:stats’:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filter, lag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The following objects are masked from ‘package:base’:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    intersect, setdiff, setequal, union</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-6-r-package-upload-test">6-6. R package upload test<a href="https://hansgun.github.io/2019/11/17/first-blog#6-6-r-package-upload-test" class="hash-link" aria-label="Direct link to 6-6. R package upload test" title="Direct link to 6-6. R package upload test">​</a></h3>
<ul>
<li>upload는 curl 등으로 진행</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## package의 DESCRIPTION version과 파일 명의 version 이 일치해야 함</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--user</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'&lt;nexusID&gt;:&lt;nexsusPW&gt;'</span><span class="token plain"> --upload-file userPackage.tar.gz http://localhost:8081/repository/r-snap/src/contrib/userPackage_0.1.0.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">##</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; install.packages('userPackage')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">오로지 소스형태로만 제공되는 패키지이므로 C/C++/Fortran으로 작성된</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  코드들에 대한 컴파일이 필요할 수도 있습니다.: ‘userPackage’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Do you want to attempt to install these from sources? (Yes/no/cancel) Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">소스형태의 패키지 ‘userPackage’(들)를 설치합니다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">URL 'http://&lt;nexusID&gt;:&lt;nexusPW&gt;@&lt;nexus r(group repository) address&gt;/src/contrib/userPackage_0.1.0.tar.gz'을 시도합니다</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content type 'application/x-gzip' length 17215032 bytes (16.4 MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">downloaded 16.4 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* installing *source* package ‘userPackage’ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">** R</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">** inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">** byte-compile and prepare package for lazy loading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">** help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*** installing help indices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">** building package indices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">** testing if installed package can be loaded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* DONE (userPackage)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">다운로드한 소스 패키지들은 다음의 위치에 있습니다</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ‘/private/var/folders/98/5jh6pvh54_n1xqk_y7c66t580000gn/T/RtmppazSJ3/downloaded_packages’</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>혹은</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">install.packages('userPackage',repos="http://&lt;nexusID&gt;:&lt;nexusPW&gt;@&lt;nexus r(group repository) address&gt;");</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-7-참고-사이트">6-7. 참고 사이트<a href="https://hansgun.github.io/2019/11/17/first-blog#6-7-%EC%B0%B8%EA%B3%A0-%EC%82%AC%EC%9D%B4%ED%8A%B8" class="hash-link" aria-label="Direct link to 6-7. 참고 사이트" title="Direct link to 6-7. 참고 사이트">​</a></h3>
<ol>
<li><a href="https://github.com/sonatype-nexus-community/nexus-repository-r" target="_blank" rel="noopener noreferrer">r-plugin github site</a></li>
<li><a href="https://github.com/sonatype-nexus-community/nexus-repository-r/blob/master/docs/R_USER_DOCUMENTATION.md" target="_blank" rel="noopener noreferrer">nexus 설정 방법</a></li>
<li><a href="https://www.r-bloggers.com/fun-with-rprofile-and-customizing-r-startup/" target="_blank" rel="noopener noreferrer">Rprofile 설정 방법</a></li>
</ol>]]></content:encoded>
            <category>jenkins</category>
            <category>nexus OSS</category>
            <category>CI/CD</category>
        </item>
        <item>
            <title><![CDATA[Set up project dev environments]]></title>
            <link>https://hansgun.github.io/2020/01/30/third-blog</link>
            <guid>https://hansgun.github.io/2020/01/30/third-blog</guid>
            <pubDate>Tue, 29 Jan 2019 00:16:01 GMT</pubDate>
            <description><![CDATA[summary]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>summary</p>
</blockquote>
<hr>
<blockquote>
<p>프로젝트 수행 결과로 민감한 정보는 [] 혹은 <code>&lt;&gt;</code> 으로 내용을 대치함</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-host-naming-convention">1.1 Host Naming Convention<a href="https://hansgun.github.io/2020/01/30/third-blog#11-host-naming-convention" class="hash-link" aria-label="Direct link to 1.1 Host Naming Convention" title="Direct link to 1.1 Host Naming Convention">​</a></h2>
<p><code>[Project]-&lt;flag&gt;&lt;node-number&gt;[-&lt;env&gt;].io</code></p>
<p><code>&lt;flag&gt;</code>:</p>
<ul>
<li>s: Service Node.</li>
<li>t: Streaming Node.</li>
<li>g: Gateway Node.</li>
</ul>
<p><code>&lt;node-number&gt;</code>: Node Numbering 으로 예를들어, '01', '02',etc.</p>
<p><code>&lt;env&gt;</code>: Deploy 환경으로, 예를들어, 개발 환경일 경우, 'dev'. 상용 환경은 없음.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-hosts-file-등록">1.2 Hosts File 등록<a href="https://hansgun.github.io/2020/01/30/third-blog#12-hosts-file-%EB%93%B1%EB%A1%9D" class="hash-link" aria-label="Direct link to 1.2 Hosts File 등록" title="Direct link to 1.2 Hosts File 등록">​</a></h2>
<p>Local 개발 Machine 의 hosts file 에 다음과 같이 등록합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">-s01-dev    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">-s01-dev.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">full_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="13-개발-server-접속">1.3 개발 Server 접속<a href="https://hansgun.github.io/2020/01/30/third-blog#13-%EA%B0%9C%EB%B0%9C-server-%EC%A0%91%EC%86%8D" class="hash-link" aria-label="Direct link to 1.3 개발 Server 접속" title="Direct link to 1.3 개발 Server 접속">​</a></h2>
<p>개발 Server 접속 방법은 다음과 같습니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">aws-pem</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> cento-s01-dev.io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>접속후 사용자를 <code>&lt;UserID&gt;</code> 로 전환합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">su</span><span class="token plain"> - </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UserID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="14-설치된-components">1.4 설치된 Components<a href="https://hansgun.github.io/2020/01/30/third-blog#14-%EC%84%A4%EC%B9%98%EB%90%9C-components" class="hash-link" aria-label="Direct link to 1.4 설치된 Components" title="Direct link to 1.4 설치된 Components">​</a></h2>
<p>개발 Server 에 설치된 중요 Component 들은 다음과 같습니다.</p>
<ul>
<li>JDK 1.8</li>
<li>Maven 3.x</li>
<li>Docker</li>
<li>Redis</li>
<li>PostgreSQL</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="15-postgresql-db-연결">1.5 PostgreSQL DB 연결<a href="https://hansgun.github.io/2020/01/30/third-blog#15-postgresql-db-%EC%97%B0%EA%B2%B0" class="hash-link" aria-label="Direct link to 1.5 PostgreSQL DB 연결" title="Direct link to 1.5 PostgreSQL DB 연결">​</a></h2>
<p>PostgreSQL Client 로 PostgreSQL Server 에 다음과 같이 연결할수 있습니다.</p>
<p>Airflow DB:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">psql -h</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">-s01-dev  </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> airflow </span><span class="token parameter variable" style="color:#36acaa">-W</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>User sample DB:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">psql -h</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">-s01-dev </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">userschema</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-W</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">userDB_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~~## 1.6 Airflow Components ( Old Version. See 1.7 section)~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~~설치된 Airflow Component 들은 Docker Container 로서 실행되고 있습니다.~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~~설치된 Airflow Component 들은 다음과 같습니다.~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~~WebServer: [http:&lt;서버IP&gt;:8080]~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~~Worker~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~~Scheduler~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~~Flower: [http:&lt;서버IP&gt;:5555]~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### ~~1.6.1 Airflow Docker 설치 방법 v.1 (Old Version.)~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~~Docker Container 형태로 Airflow 를 설치하는 방법을 설명하겠습니다.~~</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># add user to docker group.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">su</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">userID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-aG</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">whoami</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># airflow docker build.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## NOTE: docker airflow is originated from https://github.com/puckel/docker-airflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.git</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> fetch origin</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout dev</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> workflow/docker-airflow</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------ R 관련 추가 사항</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># R이 포함된 이미지는 workflow/docker-airflow/docker_with_R 에 있음..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># customized R package tar 생성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> workflow/docker-airflow/docker_with_R</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> make_skytale_tar.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/docker-airflow-withR </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 아래의 docker build 생략</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------- R 관련 추가 사항</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">끝</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/docker-airflow </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># create directories for volumes:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /data01/airflow/docker-airflow-volumes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">logs,plugins,dags</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">777</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-R</span><span class="token plain"> /data01/airflow/docker-airflow-volumes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># add python deps into requirements.txt.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/requirements.txt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Flask</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">psycopg2-binary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install rest api plugin to the directory of plugins volume.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/teamclairvoyant/airflow-rest-api-plugin/archive/v1.0.5.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## copy all the files to '/data01/airflow/docker-airflow-volumes/plugins' dir.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">su</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">userID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## webserver, worker ::: -e LD_LIBRARY_PATH=/usr/lib/jvm/java-11-openjdk-amd64/lib/server/ \ 추가</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Dockerfile 자체에 JAVA_HOME 추가해서 하는 방법 확인 필요</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># run airflow webserver.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --add-host </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버이름</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/plugins/:/usr/local/airflow/plugins </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/dags/:/usr/local/airflow/dags </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/logs/:/usr/local/airflow/logs </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/requirements.txt:/requirements.txt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/temp/:/usr/local/airflow/temp </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> REDIS_HOST </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> POSTGRES_HOST </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_DB</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__EXECUTOR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CeleryExecutor </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__SQL_ALCHEMY_CONN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"postgresql+psycopg2://airflow:&lt;password&gt; &lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CELERY__RESULT_BACKEND</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"db+postgresql://airflow:&lt;password&gt; &lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DEFAULT_TIMEZONE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LD_LIBRARY_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/lib/jvm/java-11-openjdk-amd64/lib/server/ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">:8080 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> airflow-webserver </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/docker-airflow webserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># view docker logs: airflow webserver.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> airflow-webserver</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># run airflow worker.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --add-hosT </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버이름</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/plugins/:/usr/local/airflow/plugins </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/dags/:/usr/local/airflow/dags </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/logs/:/usr/local/airflow/logs </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/requirements.txt:/requirements.txt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/temp/:/usr/local/airflow/temp </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> REDIS_HOST </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> POSTGRES_HOST </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_DB</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__EXECUTOR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CeleryExecutor </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__SQL_ALCHEMY_CONN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"postgresql+psycopg2://airflow:&lt;password&gt; &lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CELERY__RESULT_BACKEND</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"db+postgresql://airflow:&lt;password&gt; &lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DEFAULT_TIMEZONE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LD_LIBRARY_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/lib/jvm/java-11-openjdk-amd64/lib/server/ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">:8793 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> airflow-worker </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/docker-airflow worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># view docker logs: airflow worker.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> airflow-worker</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># run airflow scheduler.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --add-host </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버이름</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/plugins/:/usr/local/airflow/plugins </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/dags/:/usr/local/airflow/dags </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/logs/:/usr/local/airflow/logs </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/requirements.txt:/requirements.txt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/temp/:/usr/local/airflow/temp </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">REDIS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_DB</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__EXECUTOR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CeleryExecutor </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__SQL_ALCHEMY_CONN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"postgresql+psycopg2://airflow:&lt;password&gt;@&lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CELERY__RESULT_BACKEND</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"db+postgresql://airflow:&lt;password&gt;@&lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DEFAULT_TIMEZONE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> airflow-scheduler </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/docker-airflow scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># view docker logs: airflow scheduler.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> airflow-scheduler</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># run airflow flower.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --add-host </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버이름</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/plugins/:/usr/local/airflow/plugins </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/dags/:/usr/local/airflow/dags </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/logs/:/usr/local/airflow/logs </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/requirements.txt:/requirements.txt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data01/airflow/docker-airflow-volumes/temp/:/usr/local/airflow/temp </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">REDIS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_DB</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">airflow </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__EXECUTOR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CeleryExecutor </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__SQL_ALCHEMY_CONN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"postgresql+psycopg2://airflow:&lt;password&gt;@&lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CELERY__RESULT_BACKEND</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"db+postgresql://airflow:&lt;password&gt;@&lt;서버IP&gt;:5432/airflow"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AIRFLOW__CORE__DEFAULT_TIMEZONE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Seoul </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">:5555 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> airflow-flower </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/docker-airflow flower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># view docker logs: airflow flower.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> airflow-flower</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># check rest api.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--header</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rest_api_plugin_http_token: changeme"</span><span class="token plain"> http://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:8080/admin/rest_api/api?api</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deploy dag.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-X</span><span class="token plain"> POST </span><span class="token parameter variable" style="color:#36acaa">--header</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rest_api_plugin_http_token: changeme"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-H</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Content-Type: multipart/form-data'</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-F</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'dag_file=@&lt;project_name&gt;-test-dag8.py'</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-F</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'force=on'</span><span class="token plain"> http://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:8080/admin/rest_api/api?api</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">deploy_dag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># trigger dag.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--header</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rest_api_plugin_http_token: changeme"</span><span class="token plain"> http://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">서버IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:8080/admin/rest_api/api?api</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">trigger_dag</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">dag_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tutorial-</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="17-airflow-docker-설치-방�법-v2-using-docker-compose">1.7 Airflow Docker 설치 방법 v.2 (using docker-compose)<a href="https://hansgun.github.io/2020/01/30/third-blog#17-airflow-docker-%EC%84%A4%EC%B9%98-%EB%B0%A9%EB%B2%95-v2-using-docker-compose" class="hash-link" aria-label="Direct link to 1.7 Airflow Docker 설치 방법 v.2 (using docker-compose)" title="Direct link to 1.7 Airflow Docker 설치 방법 v.2 (using docker-compose)">​</a></h2>
<ul>
<li>docker compose를 통하여 component dependency를 고려하여 single command로 실행</li>
<li>실제 수행 내용은 v.1 과 동일.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="171-설치과정">1.7.1 설치과정<a href="https://hansgun.github.io/2020/01/30/third-blog#171-%EC%84%A4%EC%B9%98%EA%B3%BC%EC%A0%95" class="hash-link" aria-label="Direct link to 1.7.1 설치과정" title="Direct link to 1.7.1 설치과정">​</a></h3>
<p>파일 위치 : <code>[Project]/workflow/docker-airflow</code>
관련 파일 :</p>
<ul>
<li><code>docker-compose.yml</code></li>
<li><code>.env</code> [ .env는 현재 local 설정, 개발기에서는 .env_dev와 교체 필요.. ]</li>
<li>실행 명령 : <code>docker-compose -p [Project] up -d --build</code> 실행 시 container이름은 <code>[Project]_&lt;container 이름&gt;_&lt;인스턴스 번호&gt;</code> 형태</li>
</ul>
<p><code>.env</code> 파일 내용 : 환경에 맞게 변경 필요</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">###### section 1. postgre</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POSTGRES_HOST=192.168.3.108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo ${POSTGRES_HOST}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POSTGRES_USER=airflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POSTGRES_PASSWORD=***** # 실제 패스워드</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">###### section 2. redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REDIS_HOST=192.168.3.108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">###### section 3. APP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_HOST_NAME=[Project]-app.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_HOST_IP=192.168.3.108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_VOLUMN_DIR=/Users/han/data01/airflow/docker-airflowvolumns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>docker-compose.yml</code> 파일 내용 (주석 내용은 현재 환경에 이미 설치되어 있다고 가정하였을 때)</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'2.1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#  postgre:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#    image: postgres:10.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#    environment:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      - POSTGRES_DB=airflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      - POSTGRES_USER=${POSTGRES_USER}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      - POSTGRES_INITDB_ARGS=--encoding=UTF-8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#    ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      - "5432:5432"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#    healthcheck:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      test: "pg_isready -h localhost -p 5432 -q -U postgres"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      interval: 3s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      timeout: 1s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      retries: 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#  redis:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#    image: redis:3.2.12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#    ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#      - "6379:6379"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">airflow-webserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> webserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REDIS_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_USER=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_PASSWORD=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_DB=airflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__EXECUTOR=CeleryExecutor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__SQL_ALCHEMY_CONN="postgresql+psycopg2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CELERY__RESULT_BACKEND="db+postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/plugins/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/dags/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/dags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/logs/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#- ${APP_VOLUMN_DIR}/requirements.txt:/requirements.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/temp/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/temp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"8080:8080"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#depends_on:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#- postgre</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#- redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">airflow-scheduler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REDIS_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_USER=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_PASSWORD=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_DB=airflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__EXECUTOR=CeleryExecutor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__SQL_ALCHEMY_CONN="postgresql+psycopg2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CELERY__RESULT_BACKEND="db+postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/plugins/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/dags/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/dags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/logs/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#- ${APP_VOLUMN_DIR}/requirements.txt:/requirements.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/temp/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/temp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">webserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">airflow-flower</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REDIS_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_USER=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_PASSWORD=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_DB=airflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__EXECUTOR=CeleryExecutor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__SQL_ALCHEMY_CONN="postgresql+psycopg2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CELERY__RESULT_BACKEND="db+postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/plugins/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/dags/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/dags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/logs/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#- ${APP_VOLUMN_DIR}/requirements.txt:/requirements.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/temp/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/temp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"5555:5555"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#depends_on:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#- redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">airflow-worker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./docker_with_R/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REDIS_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_HOST=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_USER=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_PASSWORD=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_DB=airflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__EXECUTOR=CeleryExecutor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__SQL_ALCHEMY_CONN="postgresql+psycopg2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CELERY__RESULT_BACKEND="db+postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">POSTGRES_HOST</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/airflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_HOST_IP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/plugins/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/dags/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/dags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/logs/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">#- ${APP_VOLUMN_DIR}/requirements.txt:/requirements.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">APP_VOLUMN_DIR</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/temp/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/local/airflow/temp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/localtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"8793:8793"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="172-실행결과">1.7.2 실행결과<a href="https://hansgun.github.io/2020/01/30/third-blog#172-%EC%8B%A4%ED%96%89%EA%B2%B0%EA%B3%BC" class="hash-link" aria-label="Direct link to 1.7.2 실행결과" title="Direct link to 1.7.2 실행결과">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> up </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-webserver_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recreating </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-flower_1                 </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recreating b415085d2612_</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-webserver_1 </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-scheduler_1                </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-worker_1                   </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                            NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3a82d6c17ee0        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-worker      </span><span class="token string" style="color:#e3116c">"/entrypoint.sh work…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> seconds ago       Up </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> seconds        </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8793-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp       </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-worker_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">87e87e660969        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-scheduler   </span><span class="token string" style="color:#e3116c">"/entrypoint.sh sche…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> seconds ago       Up </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> seconds        </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp                     </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-scheduler_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c70230f8b1d3        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-flower      </span><span class="token string" style="color:#e3116c">"/entrypoint.sh flow…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> seconds ago       Up </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> seconds        </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:5555-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp       </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-flower_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c726e9fdfbc2        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-webserver   </span><span class="token string" style="color:#e3116c">"/entrypoint.sh webs…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> seconds ago       Up </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> seconds        </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8080-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp       </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_airflow-webserver_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="173-scale-out-test">1.7.3 scale-out test<a href="https://hansgun.github.io/2020/01/30/third-blog#173-scale-out-test" class="hash-link" aria-label="Direct link to 1.7.3 scale-out test" title="Direct link to 1.7.3 scale-out test">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain">                                                                                                                        CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32b99476f0ab        airflow_worker      </span><span class="token string" style="color:#e3116c">"/entrypoint.sh work…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp                 airflow_worker_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ac788e72dd21        airflow_scheduler   </span><span class="token string" style="color:#e3116c">"/entrypoint.sh sche…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp                 airflow_scheduler_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0cb6456b4869        airflow_flower      </span><span class="token string" style="color:#e3116c">"/entrypoint.sh flow…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">29</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:5555-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp   airflow_flower_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4483b48d0078        airflow_webserver   </span><span class="token string" style="color:#e3116c">"/entrypoint.sh webs…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">29</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8080-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp   airflow_webserver_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> airflow scale </span><span class="token assign-left variable" style="color:#36acaa">worker</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: The scale </span><span class="token builtin class-name">command</span><span class="token plain"> is deprecated. Use the up </span><span class="token builtin class-name">command</span><span class="token plain"> with the </span><span class="token parameter variable" style="color:#36acaa">--scale</span><span class="token plain"> flag instead.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting airflow_worker_1 </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating airflow_worker_2 </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">71e9fce448f2        airflow_worker      </span><span class="token string" style="color:#e3116c">"/entrypoint.sh work…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> seconds ago       Up </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> seconds        </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp                 airflow_worker_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32b99476f0ab        airflow_worker      </span><span class="token string" style="color:#e3116c">"/entrypoint.sh work…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">44</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">43</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp                 airflow_worker_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ac788e72dd21        airflow_scheduler   </span><span class="token string" style="color:#e3116c">"/entrypoint.sh sche…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">44</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp                 airflow_scheduler_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0cb6456b4869        airflow_flower      </span><span class="token string" style="color:#e3116c">"/entrypoint.sh flow…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">47</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:5555-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp   airflow_flower_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4483b48d0078        airflow_webserver   </span><span class="token string" style="color:#e3116c">"/entrypoint.sh webs…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">47</span><span class="token plain"> seconds ago      Up </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> seconds       </span><span class="token number" style="color:#36acaa">5555</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">8793</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8080-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp   airflow_webserver_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="18-r-package-설치-방법">1.8 R Package 설치 방법<a href="https://hansgun.github.io/2020/01/30/third-blog#18-r-package-%EC%84%A4%EC%B9%98-%EB%B0%A9%EB%B2%95" class="hash-link" aria-label="Direct link to 1.8 R Package 설치 방법" title="Direct link to 1.8 R Package 설치 방법">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${</span><span class="token variable punctuation" style="color:#393A34">[</span><span class="token variable" style="color:#36acaa">Project</span><span class="token variable punctuation" style="color:#393A34">]</span><span class="token variable" style="color:#36acaa">_ROOT_DIR}</span><span class="token plain">/workflow/job-runner/skytale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"install.packages('devtools', repos='https://cloud.r-project.org'); library(devtools); devtools::install('./')"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dev</category>
        </item>
    </channel>
</rss>